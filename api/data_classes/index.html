
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for A-Profiles">
      
      
        <meta name="author" content="Augustin Mortier">
      
      
        <link rel="canonical" href="https://github.com/AugustinMortier/A-Profiles/api/data_classes/">
      
      
        <link rel="prev" href="../reading/">
      
      
        <link rel="next" href="../detection/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Data Classes - A-Profiles</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-classes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="A-Profiles" class="md-header__button md-logo" aria-label="A-Profiles" data-md-component="logo">
      
  <img src="../../assets/images/a-profiles.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            A-Profiles
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Data Classes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/AugustinMortier/A-Profiles" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    AugustinMortier/A-Profiles
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../examples/" class="md-tabs__link">
        
  
  
    
  
  Examples

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="A-Profiles" class="md-nav__button md-logo" aria-label="A-Profiles" data-md-component="logo">
      
  <img src="../../assets/images/a-profiles.svg" alt="logo">

    </a>
    A-Profiles
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AugustinMortier/A-Profiles" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    AugustinMortier/A-Profiles
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Data Classes
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Data Classes
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#profilesdata" class="md-nav__link">
    <span class="md-ellipsis">
      ProfilesData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.profiles" class="md-nav__link">
    <span class="md-ellipsis">
      profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.profiles.ProfilesData" class="md-nav__link">
    <span class="md-ellipsis">
      ProfilesData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aeronet" class="md-nav__link">
    <span class="md-ellipsis">
      Aeronet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.aeronet" class="md-nav__link">
    <span class="md-ellipsis">
      aeronet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.aeronet.AeronetData" class="md-nav__link">
    <span class="md-ellipsis">
      AeronetData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rayleigh" class="md-nav__link">
    <span class="md-ellipsis">
      Rayleigh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.rayleigh" class="md-nav__link">
    <span class="md-ellipsis">
      rayleigh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.rayleigh.RayleighData" class="md-nav__link">
    <span class="md-ellipsis">
      RayleighData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#size-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      Size Distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.size_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      size_distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.size_distribution.SizeDistributionData" class="md-nav__link">
    <span class="md-ellipsis">
      SizeDistributionData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mass-to-extinction-coefficient" class="md-nav__link">
    <span class="md-ellipsis">
      Mass to Extinction Coefficient
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.mec" class="md-nav__link">
    <span class="md-ellipsis">
      mec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.mec.MECData" class="md-nav__link">
    <span class="md-ellipsis">
      MECData
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../retrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retrieval
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simulation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plotting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#profilesdata" class="md-nav__link">
    <span class="md-ellipsis">
      ProfilesData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.profiles" class="md-nav__link">
    <span class="md-ellipsis">
      profiles
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.profiles.ProfilesData" class="md-nav__link">
    <span class="md-ellipsis">
      ProfilesData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aeronet" class="md-nav__link">
    <span class="md-ellipsis">
      Aeronet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.aeronet" class="md-nav__link">
    <span class="md-ellipsis">
      aeronet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.aeronet.AeronetData" class="md-nav__link">
    <span class="md-ellipsis">
      AeronetData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rayleigh" class="md-nav__link">
    <span class="md-ellipsis">
      Rayleigh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.rayleigh" class="md-nav__link">
    <span class="md-ellipsis">
      rayleigh
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.rayleigh.RayleighData" class="md-nav__link">
    <span class="md-ellipsis">
      RayleighData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#size-distribution" class="md-nav__link">
    <span class="md-ellipsis">
      Size Distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.size_distribution" class="md-nav__link">
    <span class="md-ellipsis">
      size_distribution
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.size_distribution.SizeDistributionData" class="md-nav__link">
    <span class="md-ellipsis">
      SizeDistributionData
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mass-to-extinction-coefficient" class="md-nav__link">
    <span class="md-ellipsis">
      Mass to Extinction Coefficient
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.mec" class="md-nav__link">
    <span class="md-ellipsis">
      mec
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aprofiles.mec.MECData" class="md-nav__link">
    <span class="md-ellipsis">
      MECData
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="data-classes">Data Classes<a class="headerlink" href="#data-classes" title="Permanent link">&para;</a></h1>
<p><span class="twemoji" style="text-align: center; font-size: xx-large; display: block"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4"/></svg></span></p>
<h2 id="profilesdata">ProfilesData<a class="headerlink" href="#profilesdata" title="Permanent link">&para;</a></h2>
<p>The <a href="#profilesdata"><code>ProfilesData</code></a> class contains profile data information. Most of the information can be found in the <code>data</code> attribute, which is an <a href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.html"><code>xarray.Dataset</code></a>. Detection and retrieval methods might add information as additional <a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.html"><code>xarray.DataArray</code></a>.</p>


<div class="doc doc-object doc-module">



<a id="aprofiles.profiles"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aprofiles.profiles.ProfilesData" class="doc doc-heading">
            <code>ProfilesData</code>


<a href="#aprofiles.profiles.ProfilesData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Base class representing profiles data returned by (aprofiles.reader.ReadProfiles):.</p>







              <details class="quote">
                <summary>Source code in <code>aprofiles/profiles.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProfilesData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class representing profiles data returned by (aprofiles.reader.ReadProfiles):.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Data attribute (instance of (xarray.Dataset):)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Wrong data type: an xarray Dataset is expected.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_index_from_altitude_AGL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altitude</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the closest index of the ProfilesData vertical dimension to a given AGL altitude</span>

<span class="sd">        Args:</span>
<span class="sd">            altitude (float): in m, altitude AGL to look for</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): Closest index of the vertical dimension to the given altitude AGL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">altitude</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_indices_from_altitude_AGL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altitude</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an array of the closest indexes of the ProfilesData vertical dimension to given AGL altitudes</span>

<span class="sd">        Args:</span>
<span class="sd">            altitudes (array-like): in m, altitudes AGL to look for</span>

<span class="sd">        Returns:</span>
<span class="sd">            (np.ndarray): Array of closest indices of the vertical dimension to the given altitudes AGL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">altitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">station_altitude</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">altitude</span><span class="p">)</span>
        <span class="n">closest_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">alt</span><span class="p">)))</span> <span class="k">for</span> <span class="n">alt</span> <span class="ow">in</span> <span class="n">altitudes</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">closest_indices</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the resolution of a given dimension. Supports &#39;altitude&#39; and &#39;time&#39;.</span>
<span class="sd">        The altitude resolution is given in meters, while the time resolution is given in seconds.</span>

<span class="sd">        Args:</span>
<span class="sd">            which (str): Dimension: must be [&#39;altitude&#39;, &#39;time&#39;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): resolution, in m (if which==&#39;altitude&#39;) or in s (if which==&#39;time&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;altitude&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;timedelta64[s]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_lowest_clouds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># returns an array of the altitude (in m, ASL) of the lowest cloud for each timestamp</span>
        <span class="n">lowest_clouds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
            <span class="n">clouds_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clouds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">i_clouds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">clouds_profile</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_clouds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lowest_clouds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i_clouds</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">lowest_clouds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_itime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the index of closest datetime available of the ProfilesData object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span>
        <span class="n">i_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">i_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that calculates the Signal to Noise Ratio.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str, optional): Variable of the DataArray to calculate the SNR from.</span>
<span class="sd">            step (int, optional): Number of steps around we calculate the SNR for a given altitude.</span>
<span class="sd">            verbose (bool, optional): Verbose mode.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData): object with additional (xarray.DataArray): `snr`.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            # read example file</span>
<span class="sd">            path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">            reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">            profiles = reader.read()</span>
<span class="sd">            # snr calculation</span>
<span class="sd">            profiles.snr()</span>
<span class="sd">            # snr image</span>
<span class="sd">            profiles.plot(var=&#39;snr&#39;,vmin=0, vmax=3, cmap=&#39;Greys_r&#39;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the dimensions of the data array</span>
        <span class="n">time_len</span><span class="p">,</span> <span class="n">altitude_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Preallocate the SNR array with zeros</span>
        <span class="n">snr_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_len</span><span class="p">,</span> <span class="n">altitude_len</span><span class="p">))</span>

        <span class="c1"># Loop over each time step</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">time_len</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;snr   &quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
            <span class="c1"># Extract 1D slice for current time step</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>

            <span class="c1"># Create a sliding window view for the rolling calculation</span>
            <span class="n">sliding_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span>
                <span class="n">array</span><span class="p">,</span> <span class="n">window_shape</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

            <span class="c1"># Calculate mean and std across the window axis</span>
            <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">sliding_windows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">sliding_windows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Handle the edges (where sliding window can&#39;t be applied due to boundary)</span>
            <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">means</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="n">step</span><span class="p">,),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>
            <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
                <span class="n">stds</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="n">step</span><span class="p">,),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>

            <span class="c1"># Avoid division by zero</span>
            <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">stds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span>

            <span class="c1"># Compute SNR</span>
            <span class="n">snr_array</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">stds</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Add the SNR DataArray to the object&#39;s data attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">),</span> <span class="n">snr_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">snr</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Signal to Noise Ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gaussian_filter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies a 2D gaussian filter in order to reduce high frequency noise.</span>

<span class="sd">        Args:</span>
<span class="sd">            sigma (scalar or sequence of scalars, optional): Standard deviation for Gaussian kernel. The standard deviations of the Gaussian filter are given for each axis as a sequence, or as a single number, in which case it is equal for all axes.</span>
<span class="sd">            var (str, optional): variable name of the Dataset to be processed.</span>
<span class="sd">            inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData): object with additional attributes `gaussian_filter` for the processed (xarray.DataArray):.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            # read example file</span>
<span class="sd">            path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">            reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">            profiles = reader.read()</span>
<span class="sd">            # apply gaussian filtering</span>
<span class="sd">            profiles.gaussian_filter(sigma=0.5, inplace=True)</span>
<span class="sd">            profiles.data.attenuated_backscatter_0.attrs.gaussian_filter</span>
<span class="sd">            0.50</span>
<span class="sd">            ```</span>

<span class="sd">            ![Before gaussian filtering](../../assets/images/attenuated_backscatter.png)</span>
<span class="sd">            ![After gaussian filtering (sigma=0.5)](../../assets/images/gaussian_filter.png)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">gaussian_filter</span>

        <span class="c1"># apply gaussian filter</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
            <span class="n">new_dataset</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
            <span class="n">new_dataset</span> <span class="o">=</span> <span class="n">copied_dataset</span>
        <span class="c1"># add attribute</span>
        <span class="n">new_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;gaussian_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="k">return</span> <span class="n">new_dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">time_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rolling median in the time dimension.</span>

<span class="sd">        Args:</span>
<span class="sd">            minutes (float): Number of minutes to average over.</span>
<span class="sd">            var (str, optional): variable of the Dataset to be processed.</span>
<span class="sd">            inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># time conversion from minutes to seconds</span>
        <span class="n">t_avg</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
        <span class="c1"># time resolution in profiles data in seconds</span>
        <span class="n">dt_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_resolution</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="c1"># number of timestamps to be to averaged</span>
        <span class="n">nt_avg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">t_avg</span> <span class="o">/</span> <span class="n">dt_s</span><span class="p">)])</span>
        <span class="c1"># rolling median</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">rcs</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">nt_avg</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
            <span class="n">new_dataset</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
            <span class="n">new_dataset</span> <span class="o">=</span> <span class="n">copied_dataset</span>
        <span class="c1"># add attribute</span>
        <span class="n">new_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time averaged (minutes)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minutes</span>
        <span class="k">return</span> <span class="n">new_dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extrapolate_below</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cst&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for extrapolating lowest layers below a certain altitude. This is of particular intrest for instruments subject to After Pulse effect, with saturated signal in the lowest layers.</span>
<span class="sd">        We recommend to use a value of zmin=150m due to random values often found below that altitude which perturbs the clouds detection.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str, optional): variable of the :class:`xarray.Dataset` to be processed.</span>
<span class="sd">            z (float, optional): Altitude (in m, AGL) below which the signal is extrapolated.</span>
<span class="sd">            method ({&#39;cst&#39;, &#39;lin&#39;}, optional): Method to be used for extrapolation of lowest layers.</span>
<span class="sd">            inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData): object with additional attributes:</span>

<span class="sd">                - `extrapolation_low_layers_altitude_agl`</span>
<span class="sd">                - `extrapolation_low_layers_method` for the processed (xarray.DataArray):.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            # read example file</span>
<span class="sd">            path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">            reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">            profiles = reader.read()</span>
<span class="sd">            # desaturation below 4000m</span>
<span class="sd">            profiles.extrapolate_below(z=150., inplace=True)</span>
<span class="sd">            profiles.data.attenuated_backscatter_0.extrapolation_low_layers_altitude_agl</span>
<span class="sd">            150</span>
<span class="sd">            ```</span>

<span class="sd">            ![Before extrapolation](../../assets/images/lowest.png)</span>
<span class="sd">            ![After extrapolation](../../assets/images/lowest_extrap.png)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># get index of z</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices_from_altitude_AGL</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cst&quot;</span><span class="p">:</span>
            <span class="c1"># get values at imax indices</span>
            <span class="n">data_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">)])</span>

            <span class="c1"># replace values</span>
            <span class="n">filling_matrice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">imax</span><span class="p">),</span> <span class="n">data_zmax</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">)]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;lin&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Linear extrapolation is not implemented yet&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected string: lin or cst&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filling_matrice</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">filling_matrice</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
                <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filling_matrice</span><span class="p">[</span>
                    <span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

        <span class="c1"># add attributes</span>
        <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;extrapolation_low_layers_altitude_agl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
        <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;extrapolation_low_layers_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">return</span> <span class="n">new_profiles_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">range_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method that corrects the solid angle effect (1/z2) which makes that the backscatter beam is more unlikely to be detected with the square of the altitude.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str, optional): variable of the Dataset to be processed.</span>
<span class="sd">            inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData):</span>

<span class="sd">        .. warning::</span>
<span class="sd">            Make sure that the range correction is not already applied to the selected variable.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">range_corrected_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="c1"># for the altitude correction, must one use the altitude above the ground level</span>
            <span class="n">z_agl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">station_altitude</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">range_corrected_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">z_agl</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">range_corrected_data</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">range_corrected_data</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

        <span class="c1"># add attribute</span>
        <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;range correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># remove units</span>
        <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">new_profiles_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">desaturate_below</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove saturation caused by clouds at low altitude which results in negative values above the maximum.</span>
<span class="sd">        The absolute value of the signal is returned below the prescribed altitude.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str, optional): variable of the :class:`xarray.Dataset` to be processed.</span>
<span class="sd">            z (float, optional): Altitude (in m, AGL) below which the signal is unsaturated.</span>
<span class="sd">            inplace (bool, optional): if True, replace the instance of the (ProfilesData):.</span>

<span class="sd">        Todo:</span>
<span class="sd">            Refine method to desaturate only saturated areas.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (ProfilesData): object with additional attribute `desaturate` for the processed (xarray.DataArray):.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            For now, absolute values are returned everywhere below the prescribed altitude.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            # read example file</span>
<span class="sd">            path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">            reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">            profiles = reader.read()</span>
<span class="sd">            # desaturation below 4000m</span>
<span class="sd">            profiles.desaturate_below(z=4000., inplace=True)</span>
<span class="sd">            profiles.data.attenuated_backscatter_0.desaturated</span>
<span class="sd">            True</span>
<span class="sd">            ```</span>

<span class="sd">            ![Before desaturation](../../assets/images/saturated.png)</span>
<span class="sd">            ![After desaturation](../../assets/images/desaturated.png)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices_from_altitude_AGL</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="n">unsaturated_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">unsaturated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">unsaturated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">unsaturated_data</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">unsaturated_data</span>
            <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

        <span class="c1"># add attribute</span>
        <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;desaturated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_profiles_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">foc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cloud_base&quot;</span><span class="p">,</span>
        <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span>
        <span class="n">z_snr</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span>
        <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">zmin_cloud</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`aprofiles.detection.foc.detect_foc()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">foc</span><span class="o">.</span><span class="n">detect_foc</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">z_snr</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">zmin_cloud</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clouds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;vg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
        <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">thr_noise</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
        <span class="n">thr_clouds</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
        <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`aprofiles.detection.clouds.detect_clouds()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">detect_clouds</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">time_avg</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">thr_noise</span><span class="p">,</span> <span class="n">thr_clouds</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">verbose</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pbl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="n">zmax</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">,</span>
        <span class="n">wav_width</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
        <span class="n">under_clouds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`aprofiles.detection.pbl.detect_pbl()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">pbl</span><span class="o">.</span><span class="n">detect_pbl</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">time_avg</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">wav_width</span><span class="p">,</span> <span class="n">under_clouds</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">verbose</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inversion</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span>
        <span class="n">zmax</span><span class="o">=</span><span class="mf">6000.0</span><span class="p">,</span>
        <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">under_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span>
        <span class="n">apriori</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;mec&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_cfg&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">mass_conc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mass_conc_method</span><span class="o">=</span><span class="s2">&quot;mortier_2013&quot;</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`aprofiles.retrieval.extinction.inversion()` to calculate extinction profiles.</span>
<span class="sd">        Calls :meth:`aprofiles.retrieval.mass_conc.mec()` to calculate Mass to Extinction coefficients if `mass_conc` is true (Default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apro</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">inversion</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">time_avg</span><span class="p">,</span>
            <span class="n">zmin</span><span class="p">,</span>
            <span class="n">zmax</span><span class="p">,</span>
            <span class="n">min_snr</span><span class="p">,</span>
            <span class="n">under_clouds</span><span class="p">,</span>
            <span class="n">method</span><span class="p">,</span>
            <span class="n">apriori</span><span class="p">,</span>
            <span class="n">remove_outliers</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">mass_conc</span><span class="p">:</span>
            <span class="n">apro</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">mass_conc</span><span class="o">.</span><span class="n">concentration_profiles</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">mass_conc_method</span><span class="p">,</span> <span class="n">apriori</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">apro</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span>
        <span class="n">datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zref</span><span class="o">=</span><span class="s2">&quot;agl&quot;</span><span class="p">,</span>
        <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_foc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_pbl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">show_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
        <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plotting method.</span>
<span class="sd">        Depending on the variable selected, this method will plot an image, a single profile or a time series of the requested variable.</span>
<span class="sd">        See also :ref:`Plotting`.</span>

<span class="sd">        Args:</span>
<span class="sd">            var (str, optional): Variable to be plotted.</span>
<span class="sd">            datetime (:class:`numpy.datetime64`, optional): if provided, plot the profile for closest time. If not, plot an image constructed on all profiles.</span>
<span class="sd">            zref ({&#39;agl&#39;, &#39;asl&#39;}, optional): Base reference for the altitude axis.</span>
<span class="sd">            zmin (float, optional): Minimum altitude AGL (m).</span>
<span class="sd">            zmax (float, optional): Maximum altitude AGL (m).</span>
<span class="sd">            vmin (float, optional): Minimum value.</span>
<span class="sd">            vmax (float, optional): Maximum value.</span>
<span class="sd">            log (bool, optional): Use logarithmic scale.</span>
<span class="sd">            show_foc (bool, optional): Show fog or condensation retrievals.</span>
<span class="sd">            show_pbl (bool, optional): Show PBL height retrievals.</span>
<span class="sd">            show_clouds (bool, optional): Show clouds retrievals.</span>
<span class="sd">            cmap (str, optional): Matplotlib colormap.</span>
<span class="sd">            show_fig (bool, optional): Show Figure.</span>
<span class="sd">            save_fig (str, optional): Path of the saved figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># check if var is available</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid variable. </span><span class="se">\n</span><span class="s2"> List of available variables: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">var</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># here, check the dimension. If the variable has only the time dimension, calls timeseries method</span>
        <span class="k">if</span> <span class="n">datetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check dimension of var</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                    <span class="n">var</span><span class="p">,</span>
                    <span class="n">zref</span><span class="p">,</span>
                    <span class="n">zmin</span><span class="p">,</span>
                    <span class="n">zmax</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="p">,</span>
                    <span class="n">vmax</span><span class="p">,</span>
                    <span class="n">log</span><span class="p">,</span>
                    <span class="n">show_foc</span><span class="p">,</span>
                    <span class="n">show_pbl</span><span class="p">,</span>
                    <span class="n">show_clouds</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="p">,</span>
                    <span class="n">show_fig</span><span class="p">,</span>
                    <span class="n">save_fig</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">show_fig</span><span class="p">,</span> <span class="n">save_fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">datetime</span><span class="p">,</span>
                <span class="n">var</span><span class="p">,</span>
                <span class="n">zref</span><span class="p">,</span>
                <span class="n">zmin</span><span class="p">,</span>
                <span class="n">zmax</span><span class="p">,</span>
                <span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="p">,</span>
                <span class="n">log</span><span class="p">,</span>
                <span class="n">show_foc</span><span class="p">,</span>
                <span class="n">show_pbl</span><span class="p">,</span>
                <span class="n">show_clouds</span><span class="p">,</span>
                <span class="n">show_fig</span><span class="p">,</span>
                <span class="n">save_fig</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;V-Profiles&quot;</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls :meth:`aprofiles.io.write_profiles.write()`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apro</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_profiles</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="aprofiles.profiles.ProfilesData.data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">data</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

<a href="#aprofiles.profiles.ProfilesData.data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Data attribute (instance of (xarray.Dataset):)</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.clouds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clouds</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thr_noise</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">thr_clouds</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.clouds" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calls :meth:<code>aprofiles.detection.clouds.detect_clouds()</code>.</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clouds</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="s2">&quot;vg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dec&quot;</span><span class="p">,</span>
    <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">thr_noise</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">thr_clouds</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
    <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls :meth:`aprofiles.detection.clouds.detect_clouds()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">clouds</span><span class="o">.</span><span class="n">detect_clouds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">time_avg</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">thr_noise</span><span class="p">,</span> <span class="n">thr_clouds</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">verbose</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.desaturate_below" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">desaturate_below</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.desaturate_below" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove saturation caused by clouds at low altitude which results in negative values above the maximum.
The absolute value of the signal is returned below the prescribed altitude.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variable of the :class:<code>xarray.Dataset</code> to be processed.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Altitude (in m, AGL) below which the signal is unsaturated.</p>
              </div>
            </td>
            <td>
                  <code>4000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inplace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, replace the instance of the (ProfilesData):.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="todo" open>
  <summary>Todo</summary>
  <p>Refine method to desaturate only saturated areas.</p>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ProfilesData): object with additional attribute `desaturate` for the processed (xarray.DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>.. warning::
    For now, absolute values are returned everywhere below the prescribed altitude.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1"># read example file</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">ReadProfiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">profiles</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># desaturation below 4000m</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">desaturate_below</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mf">4000.</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attenuated_backscatter_0</span><span class="o">.</span><span class="n">desaturated</span>
<span class="kc">True</span>
</code></pre></div>
<p><img alt="Before desaturation" src="../../assets/images/saturated.png" />
<img alt="After desaturation" src="../../assets/images/desaturated.png" /></p>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">desaturate_below</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove saturation caused by clouds at low altitude which results in negative values above the maximum.</span>
<span class="sd">    The absolute value of the signal is returned below the prescribed altitude.</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str, optional): variable of the :class:`xarray.Dataset` to be processed.</span>
<span class="sd">        z (float, optional): Altitude (in m, AGL) below which the signal is unsaturated.</span>
<span class="sd">        inplace (bool, optional): if True, replace the instance of the (ProfilesData):.</span>

<span class="sd">    Todo:</span>
<span class="sd">        Refine method to desaturate only saturated areas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData): object with additional attribute `desaturate` for the processed (xarray.DataArray):.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        For now, absolute values are returned everywhere below the prescribed altitude.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        # read example file</span>
<span class="sd">        path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">        reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">        profiles = reader.read()</span>
<span class="sd">        # desaturation below 4000m</span>
<span class="sd">        profiles.desaturate_below(z=4000., inplace=True)</span>
<span class="sd">        profiles.data.attenuated_backscatter_0.desaturated</span>
<span class="sd">        True</span>
<span class="sd">        ```</span>

<span class="sd">        ![Before desaturation](../../assets/images/saturated.png)</span>
<span class="sd">        ![After desaturation](../../assets/images/desaturated.png)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices_from_altitude_AGL</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">unsaturated_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">unsaturated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">unsaturated_data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">unsaturated_data</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">unsaturated_data</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

    <span class="c1"># add attribute</span>
    <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;desaturated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_profiles_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.extrapolate_below" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extrapolate_below</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.extrapolate_below" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Method for extrapolating lowest layers below a certain altitude. This is of particular intrest for instruments subject to After Pulse effect, with saturated signal in the lowest layers.
We recommend to use a value of zmin=150m due to random values often found below that altitude which perturbs the clouds detection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variable of the :class:<code>xarray.Dataset</code> to be processed.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Altitude (in m, AGL) below which the signal is extrapolated.</p>
              </div>
            </td>
            <td>
                  <code>150</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td>
                  <code>{<span title="cst">cst</span>, <span title="lin">lin</span>}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method to be used for extrapolation of lowest layers.</p>
              </div>
            </td>
            <td>
                  <code>&#39;cst&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inplace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, replace the instance of the (ProfilesData): class.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProfilesData (aprofiles.profiles.ProfilesData)" href="#aprofiles.profiles.ProfilesData">ProfilesData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object with additional attributes:</p>
<ul>
<li><code>extrapolation_low_layers_altitude_agl</code></li>
<li><code>extrapolation_low_layers_method</code> for the processed (xarray.DataArray):.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1"># read example file</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">ReadProfiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">profiles</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># desaturation below 4000m</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">extrapolate_below</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="mf">150.</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attenuated_backscatter_0</span><span class="o">.</span><span class="n">extrapolation_low_layers_altitude_agl</span>
<span class="mi">150</span>
</code></pre></div>
<p><img alt="Before extrapolation" src="../../assets/images/lowest.png" />
<img alt="After extrapolation" src="../../assets/images/lowest_extrap.png" /></p>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extrapolate_below</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cst&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method for extrapolating lowest layers below a certain altitude. This is of particular intrest for instruments subject to After Pulse effect, with saturated signal in the lowest layers.</span>
<span class="sd">    We recommend to use a value of zmin=150m due to random values often found below that altitude which perturbs the clouds detection.</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str, optional): variable of the :class:`xarray.Dataset` to be processed.</span>
<span class="sd">        z (float, optional): Altitude (in m, AGL) below which the signal is extrapolated.</span>
<span class="sd">        method ({&#39;cst&#39;, &#39;lin&#39;}, optional): Method to be used for extrapolation of lowest layers.</span>
<span class="sd">        inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData): object with additional attributes:</span>

<span class="sd">            - `extrapolation_low_layers_altitude_agl`</span>
<span class="sd">            - `extrapolation_low_layers_method` for the processed (xarray.DataArray):.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        # read example file</span>
<span class="sd">        path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">        reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">        profiles = reader.read()</span>
<span class="sd">        # desaturation below 4000m</span>
<span class="sd">        profiles.extrapolate_below(z=150., inplace=True)</span>
<span class="sd">        profiles.data.attenuated_backscatter_0.extrapolation_low_layers_altitude_agl</span>
<span class="sd">        150</span>
<span class="sd">        ```</span>

<span class="sd">        ![Before extrapolation](../../assets/images/lowest.png)</span>
<span class="sd">        ![After extrapolation](../../assets/images/lowest_extrap.png)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get index of z</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_indices_from_altitude_AGL</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;cst&quot;</span><span class="p">:</span>
        <span class="c1"># get values at imax indices</span>
        <span class="n">data_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">)])</span>

        <span class="c1"># replace values</span>
        <span class="n">filling_matrice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">imax</span><span class="p">),</span> <span class="n">data_zmax</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">)]</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;lin&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Linear extrapolation is not implemented yet&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected string: lin or cst&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filling_matrice</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">filling_matrice</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
            <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filling_matrice</span><span class="p">[</span>
                <span class="n">t</span><span class="p">,</span> <span class="p">:</span> <span class="n">imax</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

    <span class="c1"># add attributes</span>
    <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;extrapolation_low_layers_altitude_agl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
    <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;extrapolation_low_layers_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">method</span>

    <span class="k">return</span> <span class="n">new_profiles_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.foc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">foc</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;cloud_base&#39;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">z_snr</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span> <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">zmin_cloud</span><span class="o">=</span><span class="mf">200.0</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.foc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calls :meth:<code>aprofiles.detection.foc.detect_foc()</code>.</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">foc</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cloud_base&quot;</span><span class="p">,</span>
    <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span>
    <span class="n">z_snr</span><span class="o">=</span><span class="mf">2000.0</span><span class="p">,</span>
    <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">zmin_cloud</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls :meth:`aprofiles.detection.foc.detect_foc()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">foc</span><span class="o">.</span><span class="n">detect_foc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">z_snr</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">zmin_cloud</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.gaussian_filter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.gaussian_filter" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Applies a 2D gaussian filter in order to reduce high frequency noise.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sigma</code>
            </td>
            <td>
                  <code>scalar or sequence of scalars</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Standard deviation for Gaussian kernel. The standard deviations of the Gaussian filter are given for each axis as a sequence, or as a single number, in which case it is equal for all axes.</p>
              </div>
            </td>
            <td>
                  <code>0.25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variable name of the Dataset to be processed.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inplace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, replace the instance of the (ProfilesData): class.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ProfilesData): object with additional attributes `gaussian_filter` for the processed (xarray.DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1"># read example file</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">ReadProfiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">profiles</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># apply gaussian filtering</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">attenuated_backscatter_0</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">gaussian_filter</span>
<span class="mf">0.50</span>
</code></pre></div>
<p><img alt="Before gaussian filtering" src="../../assets/images/attenuated_backscatter.png" />
<img alt="After gaussian filtering (sigma=0.5)" src="../../assets/images/gaussian_filter.png" /></p>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gaussian_filter</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies a 2D gaussian filter in order to reduce high frequency noise.</span>

<span class="sd">    Args:</span>
<span class="sd">        sigma (scalar or sequence of scalars, optional): Standard deviation for Gaussian kernel. The standard deviations of the Gaussian filter are given for each axis as a sequence, or as a single number, in which case it is equal for all axes.</span>
<span class="sd">        var (str, optional): variable name of the Dataset to be processed.</span>
<span class="sd">        inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData): object with additional attributes `gaussian_filter` for the processed (xarray.DataArray):.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        # read example file</span>
<span class="sd">        path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">        reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">        profiles = reader.read()</span>
<span class="sd">        # apply gaussian filtering</span>
<span class="sd">        profiles.gaussian_filter(sigma=0.5, inplace=True)</span>
<span class="sd">        profiles.data.attenuated_backscatter_0.attrs.gaussian_filter</span>
<span class="sd">        0.50</span>
<span class="sd">        ```</span>

<span class="sd">        ![Before gaussian filtering](../../assets/images/attenuated_backscatter.png)</span>
<span class="sd">        ![After gaussian filtering (sigma=0.5)](../../assets/images/gaussian_filter.png)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">gaussian_filter</span>

    <span class="c1"># apply gaussian filter</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">gaussian_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="n">copied_dataset</span>
    <span class="c1"># add attribute</span>
    <span class="n">new_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;gaussian_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span>
    <span class="k">return</span> <span class="n">new_dataset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.inversion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">inversion</span><span class="p">(</span><span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mf">6000.0</span><span class="p">,</span> <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">under_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="n">apriori</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s1">&#39;mec&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;use_cfg&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mass_conc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mass_conc_method</span><span class="o">=</span><span class="s1">&#39;mortier_2013&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.inversion" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calls :meth:<code>aprofiles.retrieval.extinction.inversion()</code> to calculate extinction profiles.
Calls :meth:<code>aprofiles.retrieval.mass_conc.mec()</code> to calculate Mass to Extinction coefficients if <code>mass_conc</code> is true (Default).</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inversion</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="mf">4000.0</span><span class="p">,</span>
    <span class="n">zmax</span><span class="o">=</span><span class="mf">6000.0</span><span class="p">,</span>
    <span class="n">min_snr</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">under_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">,</span>
    <span class="n">apriori</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span> <span class="s2">&quot;mec&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_cfg&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
    <span class="n">remove_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">mass_conc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">mass_conc_method</span><span class="o">=</span><span class="s2">&quot;mortier_2013&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls :meth:`aprofiles.retrieval.extinction.inversion()` to calculate extinction profiles.</span>
<span class="sd">    Calls :meth:`aprofiles.retrieval.mass_conc.mec()` to calculate Mass to Extinction coefficients if `mass_conc` is true (Default).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apro</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">extinction</span><span class="o">.</span><span class="n">inversion</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">time_avg</span><span class="p">,</span>
        <span class="n">zmin</span><span class="p">,</span>
        <span class="n">zmax</span><span class="p">,</span>
        <span class="n">min_snr</span><span class="p">,</span>
        <span class="n">under_clouds</span><span class="p">,</span>
        <span class="n">method</span><span class="p">,</span>
        <span class="n">apriori</span><span class="p">,</span>
        <span class="n">remove_outliers</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">mass_conc</span><span class="p">:</span>
        <span class="n">apro</span><span class="o">.</span><span class="n">retrieval</span><span class="o">.</span><span class="n">mass_conc</span><span class="o">.</span><span class="n">concentration_profiles</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">mass_conc_method</span><span class="p">,</span> <span class="n">apriori</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">apro</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.pbl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pbl</span><span class="p">(</span><span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">,</span> <span class="n">wav_width</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span> <span class="n">under_clouds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.pbl" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calls :meth:<code>aprofiles.detection.pbl.detect_pbl()</code>.</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pbl</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">time_avg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
    <span class="n">zmax</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">,</span>
    <span class="n">wav_width</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
    <span class="n">under_clouds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">min_snr</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls :meth:`aprofiles.detection.pbl.detect_pbl()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">apro</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">pbl</span><span class="o">.</span><span class="n">detect_pbl</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">time_avg</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">wav_width</span><span class="p">,</span> <span class="n">under_clouds</span><span class="p">,</span> <span class="n">min_snr</span><span class="p">,</span> <span class="n">verbose</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zref</span><span class="o">=</span><span class="s1">&#39;agl&#39;</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_foc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_pbl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.plot" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plotting method.
Depending on the variable selected, this method will plot an image, a single profile or a time series of the requested variable.
See also :ref:<code>Plotting</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable to be plotted.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datetime</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>class:<code>numpy.datetime64</code>, optional): if provided, plot the profile for closest time. If not, plot an image constructed on all profiles.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zref</code>
            </td>
            <td>
                  <code>{<span title="agl">agl</span>, <span title="asl">asl</span>}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base reference for the altitude axis.</p>
              </div>
            </td>
            <td>
                  <code>&#39;agl&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zmin</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum altitude AGL (m).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zmax</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum altitude AGL (m).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vmin</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vmax</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>log</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use logarithmic scale.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_foc</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show fog or condensation retrievals.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_pbl</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show PBL height retrievals.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_clouds</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show clouds retrievals.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cmap</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matplotlib colormap.</p>
              </div>
            </td>
            <td>
                  <code>&#39;coolwarm&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_fig</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show Figure.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_fig</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path of the saved figure.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span>
    <span class="n">datetime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zref</span><span class="o">=</span><span class="s2">&quot;agl&quot;</span><span class="p">,</span>
    <span class="n">zmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_foc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_pbl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_clouds</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
    <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plotting method.</span>
<span class="sd">    Depending on the variable selected, this method will plot an image, a single profile or a time series of the requested variable.</span>
<span class="sd">    See also :ref:`Plotting`.</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str, optional): Variable to be plotted.</span>
<span class="sd">        datetime (:class:`numpy.datetime64`, optional): if provided, plot the profile for closest time. If not, plot an image constructed on all profiles.</span>
<span class="sd">        zref ({&#39;agl&#39;, &#39;asl&#39;}, optional): Base reference for the altitude axis.</span>
<span class="sd">        zmin (float, optional): Minimum altitude AGL (m).</span>
<span class="sd">        zmax (float, optional): Maximum altitude AGL (m).</span>
<span class="sd">        vmin (float, optional): Minimum value.</span>
<span class="sd">        vmax (float, optional): Maximum value.</span>
<span class="sd">        log (bool, optional): Use logarithmic scale.</span>
<span class="sd">        show_foc (bool, optional): Show fog or condensation retrievals.</span>
<span class="sd">        show_pbl (bool, optional): Show PBL height retrievals.</span>
<span class="sd">        show_clouds (bool, optional): Show clouds retrievals.</span>
<span class="sd">        cmap (str, optional): Matplotlib colormap.</span>
<span class="sd">        show_fig (bool, optional): Show Figure.</span>
<span class="sd">        save_fig (str, optional): Path of the saved figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check if var is available</span>
    <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> is not a valid variable. </span><span class="se">\n</span><span class="s2"> List of available variables: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">var</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># here, check the dimension. If the variable has only the time dimension, calls timeseries method</span>
    <span class="k">if</span> <span class="n">datetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># check dimension of var</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">var</span><span class="p">,</span>
                <span class="n">zref</span><span class="p">,</span>
                <span class="n">zmin</span><span class="p">,</span>
                <span class="n">zmax</span><span class="p">,</span>
                <span class="n">vmin</span><span class="p">,</span>
                <span class="n">vmax</span><span class="p">,</span>
                <span class="n">log</span><span class="p">,</span>
                <span class="n">show_foc</span><span class="p">,</span>
                <span class="n">show_pbl</span><span class="p">,</span>
                <span class="n">show_clouds</span><span class="p">,</span>
                <span class="n">cmap</span><span class="p">,</span>
                <span class="n">show_fig</span><span class="p">,</span>
                <span class="n">save_fig</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">timeseries</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">show_fig</span><span class="p">,</span> <span class="n">save_fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">apro</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">datetime</span><span class="p">,</span>
            <span class="n">var</span><span class="p">,</span>
            <span class="n">zref</span><span class="p">,</span>
            <span class="n">zmin</span><span class="p">,</span>
            <span class="n">zmax</span><span class="p">,</span>
            <span class="n">vmin</span><span class="p">,</span>
            <span class="n">vmax</span><span class="p">,</span>
            <span class="n">log</span><span class="p">,</span>
            <span class="n">show_foc</span><span class="p">,</span>
            <span class="n">show_pbl</span><span class="p">,</span>
            <span class="n">show_clouds</span><span class="p">,</span>
            <span class="n">show_fig</span><span class="p">,</span>
            <span class="n">save_fig</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.range_correction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">range_correction</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.range_correction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Method that corrects the solid angle effect (1/z2) which makes that the backscatter beam is more unlikely to be detected with the square of the altitude.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variable of the Dataset to be processed.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inplace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, replace the instance of the (ProfilesData): class.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProfilesData (aprofiles.profiles.ProfilesData)" href="#aprofiles.profiles.ProfilesData">ProfilesData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>.. warning::
    Make sure that the range correction is not already applied to the selected variable.</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">range_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that corrects the solid angle effect (1/z2) which makes that the backscatter beam is more unlikely to be detected with the square of the altitude.</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str, optional): variable of the Dataset to be processed.</span>
<span class="sd">        inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData):</span>

<span class="sd">    .. warning::</span>
<span class="sd">        Make sure that the range correction is not already applied to the selected variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">range_corrected_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
        <span class="c1"># for the altitude correction, must one use the altitude above the ground level</span>
        <span class="n">z_agl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">station_altitude</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">range_corrected_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">z_agl</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">range_corrected_data</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">range_corrected_data</span>
        <span class="n">new_profiles_data</span> <span class="o">=</span> <span class="n">copied_dataset</span>

    <span class="c1"># add attribute</span>
    <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;range correction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># remove units</span>
    <span class="n">new_profiles_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">new_profiles_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.snr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">snr</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.snr" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Method that calculates the Signal to Noise Ratio.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable of the DataArray to calculate the SNR from.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps around we calculate the SNR for a given altitude.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Verbose mode.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>ProfilesData): object with additional (xarray.DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>snr</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1"># read example file</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">ReadProfiles</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">profiles</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c1"># snr calculation</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">snr</span><span class="p">()</span>
<span class="c1"># snr image</span>
<span class="n">profiles</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;snr&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">)</span>
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">snr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that calculates the Signal to Noise Ratio.</span>

<span class="sd">    Args:</span>
<span class="sd">        var (str, optional): Variable of the DataArray to calculate the SNR from.</span>
<span class="sd">        step (int, optional): Number of steps around we calculate the SNR for a given altitude.</span>
<span class="sd">        verbose (bool, optional): Verbose mode.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData): object with additional (xarray.DataArray): `snr`.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        # read example file</span>
<span class="sd">        path = &quot;examples/data/E-PROFILE/L2_0-20000-001492_A20210909.nc&quot;</span>
<span class="sd">        reader = apro.reader.ReadProfiles(path)</span>
<span class="sd">        profiles = reader.read()</span>
<span class="sd">        # snr calculation</span>
<span class="sd">        profiles.snr()</span>
<span class="sd">        # snr image</span>
<span class="sd">        profiles.plot(var=&#39;snr&#39;,vmin=0, vmax=3, cmap=&#39;Greys_r&#39;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the dimensions of the data array</span>
    <span class="n">time_len</span><span class="p">,</span> <span class="n">altitude_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># Preallocate the SNR array with zeros</span>
    <span class="n">snr_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_len</span><span class="p">,</span> <span class="n">altitude_len</span><span class="p">))</span>

    <span class="c1"># Loop over each time step</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">track</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">time_len</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;snr   &quot;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="n">verbose</span><span class="p">):</span>
        <span class="c1"># Extract 1D slice for current time step</span>
        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Create a sliding window view for the rolling calculation</span>
        <span class="n">sliding_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span>
            <span class="n">array</span><span class="p">,</span> <span class="n">window_shape</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># Calculate mean and std across the window axis</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">sliding_windows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">sliding_windows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Handle the edges (where sliding window can&#39;t be applied due to boundary)</span>
        <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
            <span class="n">means</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="n">step</span><span class="p">,),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span>
        <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
            <span class="n">stds</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="p">(</span><span class="n">step</span><span class="p">,),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="p">)</span>

        <span class="c1"># Avoid division by zero</span>
        <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">stds</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">stds</span><span class="p">)</span>

        <span class="c1"># Compute SNR</span>
        <span class="n">snr_array</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">stds</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Add the SNR DataArray to the object&#39;s data attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;altitude&quot;</span><span class="p">),</span> <span class="n">snr_array</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;snr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">snr</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Signal to Noise Ratio&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.time_avg" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">time_avg</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;attenuated_backscatter_0&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.time_avg" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Rolling median in the time dimension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>minutes</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of minutes to average over.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>variable of the Dataset to be processed.</p>
              </div>
            </td>
            <td>
                  <code>&#39;attenuated_backscatter_0&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inplace</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, replace the instance of the (ProfilesData): class.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="ProfilesData (aprofiles.profiles.ProfilesData)" href="#aprofiles.profiles.ProfilesData">ProfilesData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">time_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;attenuated_backscatter_0&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rolling median in the time dimension.</span>

<span class="sd">    Args:</span>
<span class="sd">        minutes (float): Number of minutes to average over.</span>
<span class="sd">        var (str, optional): variable of the Dataset to be processed.</span>
<span class="sd">        inplace (bool, optional): if True, replace the instance of the (ProfilesData): class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ProfilesData):</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rcs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># time conversion from minutes to seconds</span>
    <span class="n">t_avg</span> <span class="o">=</span> <span class="n">minutes</span> <span class="o">*</span> <span class="mi">60</span>
    <span class="c1"># time resolution in profiles data in seconds</span>
    <span class="n">dt_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_resolution</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="c1"># number of timestamps to be to averaged</span>
    <span class="n">nt_avg</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">t_avg</span> <span class="o">/</span> <span class="n">dt_s</span><span class="p">)])</span>
    <span class="c1"># rolling median</span>
    <span class="n">filtered_data</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">rcs</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">nt_avg</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">data</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">copied_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">copied_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">filtered_data</span>
        <span class="n">new_dataset</span> <span class="o">=</span> <span class="n">copied_dataset</span>
    <span class="c1"># add attribute</span>
    <span class="n">new_dataset</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time averaged (minutes)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minutes</span>
    <span class="k">return</span> <span class="n">new_dataset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.profiles.ProfilesData.write" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">base_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;V-Profiles&#39;</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#aprofiles.profiles.ProfilesData.write" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calls :meth:<code>aprofiles.io.write_profiles.write()</code>.</p>


            <details class="quote">
              <summary>Source code in <code>aprofiles/profiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;V-Profiles&quot;</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calls :meth:`aprofiles.io.write_profiles.write()`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">apro</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">write_profiles</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="aeronet">Aeronet<a class="headerlink" href="#aeronet" title="Permanent link">&para;</a></h2>
<p>Not implemented yet.</p>


<div class="doc doc-object doc-module">



<a id="aprofiles.aeronet"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aprofiles.aeronet.AeronetData" class="doc doc-heading">
            <code>AeronetData</code>


<a href="#aprofiles.aeronet.AeronetData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Base class representing profiles data returned by (aprofiles.io.reader.ReadAeronet):.</p>







              <details class="quote">
                <summary>Source code in <code>aprofiles/aeronet.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AeronetData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class representing profiles data returned by (aprofiles.io.reader.ReadAeronet):.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;AeronetData is not implemented yet&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="rayleigh">Rayleigh<a class="headerlink" href="#rayleigh" title="Permanent link">&para;</a></h2>
<p>The <a href="#rayleighdata"><code>RayleighData</code></a> class is used for producing Rayleigh profiles in a standard atmosphere.</p>


<div class="doc doc-object doc-module">



<a id="aprofiles.rayleigh"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aprofiles.rayleigh.RayleighData" class="doc doc-heading">
            <code>RayleighData</code>


<a href="#aprofiles.rayleigh.RayleighData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class for computing <em>rayleigh profile</em> in a standard atmosphere.
This class calls the :func:<code>get_optics_in_std_atmo()</code> method, which produces profiles of <code>backscatter</code> and <code>extinction</code> coefficients.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.rayleigh.RayleighData.altitude">altitude</span></code></td>
            <td>
                  <code><span title="array">array</span> - <span title="like">like</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of altitude ASL to be used to compute the rayleigh profile, in m.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.rayleigh.RayleighData.wavelength">wavelength</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength of the Rayleigh profile to be computed, in nm.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.rayleigh.RayleighData.T0">T0</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature at ground level, in K.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.rayleigh.RayleighData.P0">P0</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pressure at ground level, in hPa.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># some imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># creates altitude array</span>
<span class="n">altitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15000</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1064.</span>
<span class="c1"># produce rayleigh profile</span>
<span class="n">rayleigh</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">rayleigh</span><span class="o">.</span><span class="n">RayleighData</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="mi">298</span><span class="p">,</span> <span class="n">P0</span><span class="o">=</span><span class="mi">1013</span><span class="p">);</span>
<span class="c1"># checkout the instance attributes</span>
<span class="n">rayleigh</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;altitude&#39;</span><span class="p">,</span> <span class="s1">&#39;T0&#39;</span><span class="p">,</span> <span class="s1">&#39;P0&#39;</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="s1">&#39;cross_section&#39;</span><span class="p">,</span> <span class="s1">&#39;backscatter&#39;</span><span class="p">,</span> <span class="s1">&#39;extinction&#39;</span><span class="p">])</span>
</code></pre></div>
</details>






              <details class="quote">
                <summary>Source code in <code>aprofiles/rayleigh.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RayleighData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for computing *rayleigh profile* in a standard atmosphere.</span>
<span class="sd">    This class calls the :func:`get_optics_in_std_atmo()` method, which produces profiles of `backscatter` and `extinction` coefficients.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        altitude (array-like): array of altitude ASL to be used to compute the rayleigh profile, in m.</span>
<span class="sd">        wavelength (float): Wavelength of the Rayleigh profile to be computed, in nm.</span>
<span class="sd">        T0 (float): Temperature at ground level, in K.</span>
<span class="sd">        P0 (float): Pressure at ground level, in hPa.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # some imports</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        # creates altitude array</span>
<span class="sd">        altitude = np.arange(15,15000,15)</span>
<span class="sd">        wavelength = 1064.</span>
<span class="sd">        # produce rayleigh profile</span>
<span class="sd">        rayleigh = apro.rayleigh.RayleighData(altitude, wavelength, T0=298, P0=1013);</span>
<span class="sd">        # checkout the instance attributes</span>
<span class="sd">        rayleigh.__dict__.keys()</span>
<span class="sd">        dict_keys([&#39;altitude&#39;, &#39;T0&#39;, &#39;P0&#39;, &#39;wavelength&#39;, &#39;cross_section&#39;, &#39;backscatter&#39;, &#39;extinction&#39;])</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altitude</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="mi">298</span><span class="p">,</span> <span class="n">P0</span><span class="o">=</span><span class="mi">1013</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T0</span> <span class="o">=</span> <span class="n">T0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P0</span> <span class="o">=</span> <span class="n">P0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>

        <span class="c1"># calls functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_optics_in_std_atmo</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_optics_in_std_atmo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that returns *backscatter* and *extinction* profiles [#]_ for an instance of a (RayleighData): class.</span>

<span class="sd">        .. [#] Bucholtz, A. (1995). Rayleigh-scattering calculations for the terrestrial atmosphere. Applied optics, 34(15), 2765-2773.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (aprofiles.rayleigh.RayleighData): object with additional attributes:</span>

<span class="sd">                - `extinction` (numpy.ndarray): extinction coefficient (m-1)</span>
<span class="sd">                - `backscatter` (numpy.ndarray): backscatter coefficient (m-1.sr-1)</span>
<span class="sd">                - `cross_section` (numpy.ndarray): cross section (cm-2)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_refi_air</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function that calculates the refractive index of the air at a given wavelength in a standard atmosphere [#]_.</span>

<span class="sd">            .. [#] Peck, E. R., &amp; Reeder, K. (1972). Dispersion of air. JOSA, 62(8), 958-962.</span>

<span class="sd">            Args:</span>
<span class="sd">                wavelength (float): wavelength, in µm.</span>

<span class="sd">            Returns:</span>
<span class="sd">                refractive index of the air.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># wav (float): wavelength in µm</span>
            <span class="c1"># returns refractive index of the air in standard atmosphere (Peck and Reeder)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="p">(</span>
                <span class="mf">8060.51</span>
                <span class="o">+</span> <span class="mi">2480990</span> <span class="o">/</span> <span class="p">(</span><span class="mf">132.274</span> <span class="o">-</span> <span class="n">wavelength</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                <span class="o">+</span> <span class="mf">17455.7</span> <span class="o">/</span> <span class="p">(</span><span class="mf">39.32957</span> <span class="o">-</span> <span class="n">wavelength</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">var</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># standard values at sea level</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="mi">298</span>  <span class="c1"># K</span>
        <span class="n">P0</span> <span class="o">=</span> <span class="mi">1013</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># Pa</span>
        <span class="n">p_He</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="c1"># standard gradients &amp; parameters</span>
        <span class="n">atmo</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;tropo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.5</span><span class="p">},</span>
            <span class="s2">&quot;strato&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">},</span>
            <span class="s2">&quot;meso&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="c1"># convert altitude to km</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># vertical resolution</span>
        <span class="n">dz</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># temperature profile</span>
        <span class="n">Tz</span> <span class="o">=</span> <span class="p">[</span><span class="n">T0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">atmo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ibottom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;zmin&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dz</span><span class="p">))</span>
            <span class="n">itop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;zmax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dz</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ibottom</span><span class="p">,</span> <span class="n">itop</span><span class="p">):</span>
                <span class="n">Tz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tz</span><span class="p">[</span><span class="n">ibottom</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">ibottom</span><span class="p">)</span> <span class="o">*</span> <span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;dTdz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dz</span><span class="p">)</span>

        <span class="c1"># vertical coordinates for temperature</span>
        <span class="n">z_Tz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

        <span class="c1"># pressure profile</span>
        <span class="n">Pz</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_Tz</span> <span class="o">/</span> <span class="n">p_He</span><span class="p">)</span>

        <span class="c1"># molecules density and cross section</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.02214e23</span> <span class="o">/</span> <span class="mf">22.4141</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># molecules.cm-3</span>
        <span class="c1"># density (cm-3)</span>
        <span class="n">N_m</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ns</span> <span class="o">*</span> <span class="p">(</span><span class="n">T0</span> <span class="o">/</span> <span class="n">P0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">Tz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Pz</span><span class="p">))]</span>

        <span class="c1"># cross section, in cm2 (adapted from Bodhaine et al., 1999)</span>
        <span class="n">king_factor</span> <span class="o">=</span> <span class="mf">1.05</span>  <span class="c1"># tomasi et al., 2005</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">_refi_air</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">Ns</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">*</span> <span class="p">((</span><span class="n">_refi_air</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">section_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">denum</span><span class="p">)</span> <span class="o">*</span> <span class="n">king_factor</span>

        <span class="c1"># extinction profile</span>
        <span class="n">amol</span> <span class="o">=</span> <span class="n">N_m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">section_m</span><span class="p">)</span>
        <span class="c1"># backscatter profile</span>
        <span class="n">lr_mol</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>
        <span class="n">bmol</span> <span class="o">=</span> <span class="n">amol</span> <span class="o">/</span> <span class="n">lr_mol</span>

        <span class="c1"># colocate vertically to input altitude</span>
        <span class="n">imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_Tz</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">imin</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

        <span class="c1"># output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">section_m</span>  <span class="c1"># in cm2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backscatter</span> <span class="o">=</span> <span class="n">bmol</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># from cm-1 to m-1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span> <span class="o">=</span> <span class="n">amol</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># from cm-1 to m-1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">*</span><span class="p">(</span><span class="n">dz</span><span class="o">*</span><span class="mi">1000</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot extinction profile of an instance of the (RayleighData): class.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # some imports</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            import numpy as np</span>
<span class="sd">            # creates altitude array</span>
<span class="sd">            altitude = np.arange(15,15000,15)</span>
<span class="sd">            wavelength = 1064.</span>
<span class="sd">            # produce rayleigh profile</span>
<span class="sd">            rayleigh = apro.rayleigh.RayleighData(altitude, wavelength, T0=298, P0=1013);</span>
<span class="sd">            # plot profile</span>
<span class="sd">            rayleigh.plot()</span>
<span class="sd">            ```</span>

<span class="sd">            .. figure:: ../../docs/assets/images/rayleigh.png</span>
<span class="sd">                :scale: 80 %</span>
<span class="sd">                :alt: rayleigh profile</span>

<span class="sd">                Rayleigh extinction profile for a standard atmosphere.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.97</span><span class="p">,</span>
            <span class="mf">0.94</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$\sigma_m: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> cm2$&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.97</span><span class="p">,</span>
            <span class="mf">0.88</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">\u03C4</span><span class="s2">_m: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Rayleigh Profile in a Standard Atmosphere (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">P0</span><span class="si">}</span><span class="s2">hPa, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="si">}</span><span class="s2">K)&quot;</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extinction coefficient @ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="si">}</span><span class="s2"> nm (m-1)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Altitude ASL (m)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aprofiles.rayleigh.RayleighData.get_optics_in_std_atmo" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_optics_in_std_atmo</span><span class="p">()</span></code>

<a href="#aprofiles.rayleigh.RayleighData.get_optics_in_std_atmo" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Function that returns <em>backscatter</em> and <em>extinction</em> profiles [#]_ for an instance of a (RayleighData): class.</p>
<p>.. [#] Bucholtz, A. (1995). Rayleigh-scattering calculations for the terrestrial atmosphere. Applied optics, 34(15), 2765-2773.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="RayleighData (aprofiles.rayleigh.RayleighData)" href="#aprofiles.rayleigh.RayleighData">RayleighData</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object with additional attributes:</p>
<ul>
<li><code>extinction</code> (numpy.ndarray): extinction coefficient (m-1)</li>
<li><code>backscatter</code> (numpy.ndarray): backscatter coefficient (m-1.sr-1)</li>
<li><code>cross_section</code> (numpy.ndarray): cross section (cm-2)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aprofiles/rayleigh.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_optics_in_std_atmo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that returns *backscatter* and *extinction* profiles [#]_ for an instance of a (RayleighData): class.</span>

<span class="sd">    .. [#] Bucholtz, A. (1995). Rayleigh-scattering calculations for the terrestrial atmosphere. Applied optics, 34(15), 2765-2773.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (aprofiles.rayleigh.RayleighData): object with additional attributes:</span>

<span class="sd">            - `extinction` (numpy.ndarray): extinction coefficient (m-1)</span>
<span class="sd">            - `backscatter` (numpy.ndarray): backscatter coefficient (m-1.sr-1)</span>
<span class="sd">            - `cross_section` (numpy.ndarray): cross section (cm-2)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_refi_air</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function that calculates the refractive index of the air at a given wavelength in a standard atmosphere [#]_.</span>

<span class="sd">        .. [#] Peck, E. R., &amp; Reeder, K. (1972). Dispersion of air. JOSA, 62(8), 958-962.</span>

<span class="sd">        Args:</span>
<span class="sd">            wavelength (float): wavelength, in µm.</span>

<span class="sd">        Returns:</span>
<span class="sd">            refractive index of the air.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># wav (float): wavelength in µm</span>
        <span class="c1"># returns refractive index of the air in standard atmosphere (Peck and Reeder)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">8060.51</span>
            <span class="o">+</span> <span class="mi">2480990</span> <span class="o">/</span> <span class="p">(</span><span class="mf">132.274</span> <span class="o">-</span> <span class="n">wavelength</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="o">+</span> <span class="mf">17455.7</span> <span class="o">/</span> <span class="p">(</span><span class="mf">39.32957</span> <span class="o">-</span> <span class="n">wavelength</span> <span class="o">**</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span> <span class="o">*</span> <span class="mf">1e-8</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># standard values at sea level</span>
    <span class="n">T0</span> <span class="o">=</span> <span class="mi">298</span>  <span class="c1"># K</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="mi">1013</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># Pa</span>
    <span class="n">p_He</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># standard gradients &amp; parameters</span>
    <span class="n">atmo</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;tropo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">6.5</span><span class="p">},</span>
        <span class="s2">&quot;strato&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="mf">1.4</span><span class="p">},</span>
        <span class="s2">&quot;meso&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;zmin&quot;</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="s2">&quot;zmax&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;dTdz&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.4</span><span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># convert altitude to km</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">/</span> <span class="mi">1000</span>

    <span class="c1"># vertical resolution</span>
    <span class="n">dz</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># temperature profile</span>
    <span class="n">Tz</span> <span class="o">=</span> <span class="p">[</span><span class="n">T0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">atmo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ibottom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;zmin&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dz</span><span class="p">))</span>
        <span class="n">itop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;zmax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dz</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ibottom</span><span class="p">,</span> <span class="n">itop</span><span class="p">):</span>
            <span class="n">Tz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tz</span><span class="p">[</span><span class="n">ibottom</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">ibottom</span><span class="p">)</span> <span class="o">*</span> <span class="n">atmo</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="s2">&quot;dTdz&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">dz</span><span class="p">)</span>

    <span class="c1"># vertical coordinates for temperature</span>
    <span class="n">z_Tz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

    <span class="c1"># pressure profile</span>
    <span class="n">Pz</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z_Tz</span> <span class="o">/</span> <span class="n">p_He</span><span class="p">)</span>

    <span class="c1"># molecules density and cross section</span>
    <span class="n">Ns</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.02214e23</span> <span class="o">/</span> <span class="mf">22.4141</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># molecules.cm-3</span>
    <span class="c1"># density (cm-3)</span>
    <span class="n">N_m</span> <span class="o">=</span> <span class="p">[</span><span class="n">Ns</span> <span class="o">*</span> <span class="p">(</span><span class="n">T0</span> <span class="o">/</span> <span class="n">P0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Pz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">Tz</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Pz</span><span class="p">))]</span>

    <span class="c1"># cross section, in cm2 (adapted from Bodhaine et al., 1999)</span>
    <span class="n">king_factor</span> <span class="o">=</span> <span class="mf">1.05</span>  <span class="c1"># tomasi et al., 2005</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">_refi_air</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">Ns</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">((</span><span class="n">_refi_air</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">section_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">denum</span><span class="p">)</span> <span class="o">*</span> <span class="n">king_factor</span>

    <span class="c1"># extinction profile</span>
    <span class="n">amol</span> <span class="o">=</span> <span class="n">N_m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">section_m</span><span class="p">)</span>
    <span class="c1"># backscatter profile</span>
    <span class="n">lr_mol</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">bmol</span> <span class="o">=</span> <span class="n">amol</span> <span class="o">/</span> <span class="n">lr_mol</span>

    <span class="c1"># colocate vertically to input altitude</span>
    <span class="n">imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_Tz</span><span class="p">)</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="n">imin</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="c1"># output</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span> <span class="o">=</span> <span class="n">section_m</span>  <span class="c1"># in cm2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">backscatter</span> <span class="o">=</span> <span class="n">bmol</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># from cm-1 to m-1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">extinction</span> <span class="o">=</span> <span class="n">amol</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e2</span>  <span class="c1"># from cm-1 to m-1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="o">*</span><span class="p">(</span><span class="n">dz</span><span class="o">*</span><span class="mi">1000</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.rayleigh.RayleighData.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#aprofiles.rayleigh.RayleighData.plot" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot extinction profile of an instance of the (RayleighData): class.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># some imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1"># creates altitude array</span>
<span class="n">altitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15000</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
<span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1064.</span>
<span class="c1"># produce rayleigh profile</span>
<span class="n">rayleigh</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">rayleigh</span><span class="o">.</span><span class="n">RayleighData</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="mi">298</span><span class="p">,</span> <span class="n">P0</span><span class="o">=</span><span class="mi">1013</span><span class="p">);</span>
<span class="c1"># plot profile</span>
<span class="n">rayleigh</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<p>.. figure:: ../../docs/assets/images/rayleigh.png
    :scale: 80 %
    :alt: rayleigh profile</p>
<div class="codehilite"><pre><span></span><code>Rayleigh extinction profile for a standard atmosphere.
</code></pre></div>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/rayleigh.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot extinction profile of an instance of the (RayleighData): class.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # some imports</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        import numpy as np</span>
<span class="sd">        # creates altitude array</span>
<span class="sd">        altitude = np.arange(15,15000,15)</span>
<span class="sd">        wavelength = 1064.</span>
<span class="sd">        # produce rayleigh profile</span>
<span class="sd">        rayleigh = apro.rayleigh.RayleighData(altitude, wavelength, T0=298, P0=1013);</span>
<span class="sd">        # plot profile</span>
<span class="sd">        rayleigh.plot()</span>
<span class="sd">        ```</span>

<span class="sd">        .. figure:: ../../docs/assets/images/rayleigh.png</span>
<span class="sd">            :scale: 80 %</span>
<span class="sd">            :alt: rayleigh profile</span>

<span class="sd">            Rayleigh extinction profile for a standard atmosphere.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.97</span><span class="p">,</span>
        <span class="mf">0.94</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$\sigma_m: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cross_section</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> cm2$&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.97</span><span class="p">,</span>
        <span class="mf">0.88</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">\u03C4</span><span class="s2">_m: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Rayleigh Profile in a Standard Atmosphere (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">P0</span><span class="si">}</span><span class="s2">hPa, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">T0</span><span class="si">}</span><span class="s2">K)&quot;</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extinction coefficient @ </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="si">}</span><span class="s2"> nm (m-1)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Altitude ASL (m)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="size-distribution">Size Distribution<a class="headerlink" href="#size-distribution" title="Permanent link">&para;</a></h2>
<p>The size distribution module is used to produce volume and number size distributions of a population of particles for a given type. The values describing the size distribution for different aerosol types are taken from the literature:</p>
<ul>
<li><code>dust</code>, <code>biomass_burning</code>, and <code>urban</code> aerosols<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></li>
<li><code>volcanic_ash</code><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup></li>
</ul>
<p>Aerosol properties are defined in <a class="title-ref" href="../../aprofiles/config/aer_properties.json" role="download"><code>config/aer_properties.json</code></a></p>


<div class="doc doc-object doc-module">



<a id="aprofiles.size_distribution"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aprofiles.size_distribution.SizeDistributionData" class="doc doc-heading">
            <code>SizeDistributionData</code>


<a href="#aprofiles.size_distribution.SizeDistributionData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class for computing <em>size distributions</em> for a given aerosol type.
This class calls the <code>aprofiles.size_distribution.SizeDistributionData.get_sd</code>: method, which calculates VSD (Volume Size Distribution) and NSD (Number Size Distribution).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.size_distribution.SizeDistributionData.`aer_type`">`aer_type`</span></code></td>
            <td>
                  <code>{<span title="dust">dust</span>, <span title="volcanic_ash">volcanic_ash</span>, <span title="biomass_burning">biomass_burning</span>, <span title="urban">urban</span>}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aerosol type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.size_distribution.SizeDistributionData.`aer_properties`">`aer_properties`</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionnary describing the optical and microphophysical properties of the prescribed aerosol (read from <em>aer_properties.json</em>)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># some imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">size_distribution</span><span class="o">.</span><span class="n">SizeDistributionData</span><span class="p">(</span><span class="s1">&#39;urban&#39;</span><span class="p">)</span>
<span class="c1"># checkout the instance attributes</span>
<span class="n">apro</span><span class="o">.</span><span class="n">size_distribution</span><span class="o">.</span><span class="n">SizeDistributionData</span><span class="p">(</span><span class="s1">&#39;dust&#39;</span><span class="p">)</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;aer_type&#39;</span><span class="p">,</span> <span class="s1">&#39;aer_properties&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;vsd&#39;</span><span class="p">,</span> <span class="s1">&#39;nsd&#39;</span><span class="p">])</span>
</code></pre></div>
</details>






              <details class="quote">
                <summary>Source code in <code>aprofiles/size_distribution.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SizeDistributionData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for computing *size distributions* for a given aerosol type.</span>
<span class="sd">    This class calls the `aprofiles.size_distribution.SizeDistributionData.get_sd`: method, which calculates VSD (Volume Size Distribution) and NSD (Number Size Distribution).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        `aer_type` ({&#39;dust&#39;, &#39;volcanic_ash&#39;, &#39;biomass_burning&#39;,&#39;urban&#39;}): aerosol type.</span>
<span class="sd">        `aer_properties` (dict): dictionnary describing the optical and microphophysical properties of the prescribed aerosol (read from *aer_properties.json*)</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # some imports</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        sd = apro.size_distribution.SizeDistributionData(&#39;urban&#39;)</span>
<span class="sd">        # checkout the instance attributes</span>
<span class="sd">        apro.size_distribution.SizeDistributionData(&#39;dust&#39;).__dict__.keys()</span>
<span class="sd">        dict_keys([&#39;aer_type&#39;, &#39;aer_properties&#39;, &#39;radius&#39;, &#39;vsd&#39;, &#39;nsd&#39;])</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aer_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span> <span class="o">=</span> <span class="n">aer_type</span>

        <span class="c1"># read aer_properties.json files</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span><span class="s1">&#39;config&#39;</span><span class="p">,</span><span class="s1">&#39;aer_properties.json&#39;</span><span class="p">))</span>
        <span class="n">aer_properties</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># check if the aer_type exist in the json file</span>
        <span class="k">if</span> <span class="n">aer_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aer_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">aer_type</span><span class="si">}</span><span class="s2"> not found in aer_properties.json. `aer_type` must be one of the follwowing: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">aer_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span> <span class="o">=</span> <span class="n">aer_properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_sd</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_vsd_to_nsd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms Volume Size Distribution to Number Size Distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsd</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_sd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the Volume and Number Size Distributions arrays from an instance of the (SizeDistributionData): class .</span>

<span class="sd">        Returns:</span>
<span class="sd">            (SizeDistribData): object with additional attributes:</span>

<span class="sd">                - `radius` (numpy.ndarray): radius (µm)</span>
<span class="sd">                - `vsd` (numpy.ndarray): Volume Size Distribution (µm2.µm-3)</span>
<span class="sd">                - `nsd` (numpy.ndarray): Number Size Distribution (µm-3.µm-1)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">aer_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">2e1</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># radius in µm</span>
        <span class="n">vsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>

        <span class="c1"># we loop though all the keys defining the different modes</span>
        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">vsd</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;reff&quot;</span><span class="p">]),</span>
                <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;rstd&quot;</span><span class="p">],</span>
                <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;conc&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span> <span class="o">=</span> <span class="n">vsd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vsd_to_nsd</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot Size Distributions of an instance of the (SizeDistributionData): class.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # import aprofiles</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            # get size distribution for urban particles</span>
<span class="sd">            sd = apro.size_distribution.SizeDistribData(&#39;urban&#39;);</span>
<span class="sd">            # plot profile</span>
<span class="sd">            sd.plot()</span>
<span class="sd">            ```</span>

<span class="sd">            ![Size distributions for urban particles](../../assets/images/urban_sd.png)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># plot Volume Size Distribution in 1st axis</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;VSD&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V(r) (µm2.µm-3)&quot;</span><span class="p">)</span>

        <span class="c1"># plot Number Size Distribution in 2nd axis</span>
        <span class="k">if</span> <span class="s2">&quot;nsd&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="c1"># add secondary yaxis</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsd</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NSD&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;N(r) (µm-3.µm-1)&quot;</span><span class="p">)</span>
            <span class="c1"># ax2.set_ylim([0,10])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (µm)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Size Distribution for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Particles&quot;</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aprofiles.size_distribution.SizeDistributionData.get_sd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sd</span><span class="p">()</span></code>

<a href="#aprofiles.size_distribution.SizeDistributionData.get_sd" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns the Volume and Number Size Distributions arrays from an instance of the (SizeDistributionData): class .</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="SizeDistribData">SizeDistribData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>object with additional attributes:</p>
<ul>
<li><code>radius</code> (numpy.ndarray): radius (µm)</li>
<li><code>vsd</code> (numpy.ndarray): Volume Size Distribution (µm2.µm-3)</li>
<li><code>nsd</code> (numpy.ndarray): Number Size Distribution (µm-3.µm-1)</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aprofiles/size_distribution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the Volume and Number Size Distributions arrays from an instance of the (SizeDistributionData): class .</span>

<span class="sd">    Returns:</span>
<span class="sd">        (SizeDistribData): object with additional attributes:</span>

<span class="sd">            - `radius` (numpy.ndarray): radius (µm)</span>
<span class="sd">            - `vsd` (numpy.ndarray): Volume Size Distribution (µm2.µm-3)</span>
<span class="sd">            - `nsd` (numpy.ndarray): Number Size Distribution (µm-3.µm-1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">aer_properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">2e1</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>  <span class="c1"># radius in µm</span>
    <span class="n">vsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>

    <span class="c1"># we loop though all the keys defining the different modes</span>
    <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">vsd</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gaussian</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;reff&quot;</span><span class="p">]),</span>
            <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;rstd&quot;</span><span class="p">],</span>
            <span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;vsd&quot;</span><span class="p">][</span><span class="n">mode</span><span class="p">][</span><span class="s2">&quot;conc&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span> <span class="o">=</span> <span class="n">vsd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_vsd_to_nsd</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.size_distribution.SizeDistributionData.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#aprofiles.size_distribution.SizeDistributionData.plot" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot Size Distributions of an instance of the (SizeDistributionData): class.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1"># import aprofiles</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1"># get size distribution for urban particles</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">size_distribution</span><span class="o">.</span><span class="n">SizeDistribData</span><span class="p">(</span><span class="s1">&#39;urban&#39;</span><span class="p">);</span>
<span class="c1"># plot profile</span>
<span class="n">sd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<p><img alt="Size distributions for urban particles" src="../../assets/images/urban_sd.png" /></p>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/size_distribution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Size Distributions of an instance of the (SizeDistributionData): class.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        # import aprofiles</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        # get size distribution for urban particles</span>
<span class="sd">        sd = apro.size_distribution.SizeDistribData(&#39;urban&#39;);</span>
<span class="sd">        # plot profile</span>
<span class="sd">        sd.plot()</span>
<span class="sd">        ```</span>

<span class="sd">        ![Size distributions for urban particles](../../assets/images/urban_sd.png)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># plot Volume Size Distribution in 1st axis</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;VSD&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V(r) (µm2.µm-3)&quot;</span><span class="p">)</span>

    <span class="c1"># plot Number Size Distribution in 2nd axis</span>
    <span class="k">if</span> <span class="s2">&quot;nsd&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
        <span class="c1"># add secondary yaxis</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsd</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;NSD&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;N(r) (µm-3.µm-1)&quot;</span><span class="p">)</span>
        <span class="c1"># ax2.set_ylim([0,10])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (µm)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Size Distribution for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> Particles&quot;</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="mass-to-extinction-coefficient">Mass to Extinction Coefficient<a class="headerlink" href="#mass-to-extinction-coefficient" title="Permanent link">&para;</a></h2>
<p>The <a href="#mecdata"><code>MECData</code></a> class is used for computing a <em>Mass to Extinction Coefficient</em> for a given aerosol type.</p>


<div class="doc doc-object doc-module">



<a id="aprofiles.mec"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aprofiles.mec.MECData" class="doc doc-heading">
            <code>MECData</code>


<a href="#aprofiles.mec.MECData" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class for computing the <em>Mass to Extinction Coefficient</em> for a given aerosol type.
This class calls the <a href="#aprofiles.mec.MECData--aprofiles.mec.MECData.get_mec"><code>get_mec()</code></a> method.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.mec.MECData.`aer_type`">`aer_type`</span></code></td>
            <td>
                  <code>{<span title="dust">dust</span>, <span title="volcanic_ash">volcanic_ash</span>, <span title="biomass_burning">biomass_burning</span>, <span title="urban">urban</span>}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aerosol type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.mec.MECData.`wavelength`">`wavelength`</span></code></td>
            <td>
                  <code><span title="int">int</span> or <span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>wavelength, in mm.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.mec.MECData.`method`">`method`</span></code></td>
            <td>
                  <code>{<span title="mortier_2013">mortier_2013</span>, <span title="literature">literature</span>}</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>method to retrieve or compute <code>MEC</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="aprofiles.mec.MECData.`aer_properties`">`aer_properties`</span></code></td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary describing the optical and micro-physical properties of the prescribed aerosol (read from <em>aer_properties.json</em>)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1">#some imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="n">mec_data</span> <span class="o">=</span> <span class="n">MECData</span><span class="p">(</span><span class="s1">&#39;volcanic_ash&#39;</span><span class="p">,</span> <span class="mf">532.</span><span class="p">)</span>
<span class="n">mec_data</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;aer_type&#39;</span><span class="p">,</span> <span class="s1">&#39;wavelength&#39;</span><span class="p">,</span> <span class="s1">&#39;aer_properties&#39;</span><span class="p">,</span> <span class="s1">&#39;nsd&#39;</span><span class="p">,</span> <span class="s1">&#39;vsd&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;qext&#39;</span><span class="p">,</span> <span class="s1">&#39;conv_factor&#39;</span><span class="p">,</span> <span class="s1">&#39;mec&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mec_data</span><span class="o">.</span><span class="n">conv_factor</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> m </span><span class="si">{</span><span class="n">mec_data</span><span class="o">.</span><span class="n">mec</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> m2.g-1&#39;</span><span class="p">)</span>
<span class="mf">6.21e-07</span> <span class="n">m</span> <span class="mf">0.62</span> <span class="n">m2</span><span class="o">.</span><span class="n">g</span><span class="o">-</span><span class="mi">1</span>
</code></pre></div>
</details>






              <details class="quote">
                <summary>Source code in <code>aprofiles/mec.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MECData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for computing the *Mass to Extinction Coefficient* for a given aerosol type.</span>
<span class="sd">    This class calls the [`get_mec()`](#aprofiles.mec.MECData.get_mec) method.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       `aer_type` ({&#39;dust&#39;, &#39;volcanic_ash&#39;, &#39;biomass_burning&#39;, &#39;urban&#39;}): aerosol type.</span>
<span class="sd">       `wavelength` (int or float): wavelength, in mm.</span>
<span class="sd">       `method` ({&#39;mortier_2013&#39;, &#39;literature&#39;}): method to retrieve or compute `MEC`.</span>
<span class="sd">       `aer_properties` (dict): dictionary describing the optical and micro-physical properties of the prescribed aerosol (read from *aer_properties.json*)</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        #some imports</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        mec_data = MECData(&#39;volcanic_ash&#39;, 532.)</span>
<span class="sd">        mec_data.__dict__.keys()</span>
<span class="sd">        dict_keys([&#39;aer_type&#39;, &#39;wavelength&#39;, &#39;aer_properties&#39;, &#39;nsd&#39;, &#39;vsd&#39;, &#39;radius&#39;, &#39;qext&#39;, &#39;conv_factor&#39;, &#39;mec&#39;])</span>
<span class="sd">        print(f&#39;{mec_data.conv_factor:.2e} m {mec_data.mec):.2e} m2.g-1&#39;)</span>
<span class="sd">        6.21e-07 m 0.62 m2.g-1</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aer_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mortier_2013&quot;</span><span class="p">):</span>

        <span class="c1"># check parameters type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aer_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;`aer_type` is expected to be a string. Got </span><span class="si">{}</span><span class="s2"> instead.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">aer_type</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;`wavelength` is expected to be an int or a float. Got </span><span class="si">{}</span><span class="s2"> instead&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">available_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mortier_2013&quot;</span><span class="p">,</span> <span class="s2">&quot;literature&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">available_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid `method`. AAvailable methods are </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">available_methods</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span> <span class="o">=</span> <span class="n">aer_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mortier_2013&quot;</span><span class="p">:</span>
            <span class="c1"># read aer_properties.json files</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span><span class="s1">&#39;config&#39;</span><span class="p">,</span><span class="s1">&#39;aer_properties.json&#39;</span><span class="p">))</span>
            <span class="n">aer_properties</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c1"># check if the aer_type exist in the json file</span>
            <span class="k">if</span> <span class="n">aer_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aer_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not found in aer_properties.json. `aer_type` must be one of the follwowing: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">aer_type</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">aer_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span> <span class="o">=</span> <span class="n">aer_properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_mec</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;literature&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mec</span> <span class="o">=</span> <span class="mf">3.33</span>  <span class="c1"># CHECK V-PROFILES VALUES. CHECK CODE IN LAPTOP?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_mec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the Extinction to Mass Coefficient for a given type of particles, assuming a prescribed size distribution shape (with unknown amplitude), density, and using [Mie theory](https://miepython.readthedocs.io) to calculate the extinction efficiency.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (MECData): with additional attributes:</span>

<span class="sd">                - `nsd` (1D Array): Number Size Distribution</span>
<span class="sd">                - `vsd` (1D Array): Volume Size Distribution</span>
<span class="sd">                - `radius` (1D Array): Radius in µm</span>
<span class="sd">                - `x` (1D Array): Size parameter (unitless)</span>
<span class="sd">                - `conv_factor` (float): Conversion factor in m</span>
<span class="sd">                - `mec` (float): Extinction to Mass Coefficient in m².g⁻¹</span>

<span class="sd">       !!! note</span>
<span class="sd">            For a population of particles, the extinction coefficient $\sigma_{ext}$ (m⁻¹) can be written as follows:</span>

<span class="sd">            $$</span>
<span class="sd">            \sigma_{ext} = \int_{r_{min}}^{r_{max}} N(r) Q_{ext}(m, r, \lambda) \pi r^2 dr</span>
<span class="sd">            $$</span>

<span class="sd">            where $Q_{ext}$ is the `extinction efficiency` and $N(r)$ is the `Number Size Distribution` (NSD).</span>

<span class="sd">            $Q_{ext}$ varies with the refractive index, $m$, the wavelength, $\lambda$, and can be calculated for spherical particles using Mie theory.</span>

<span class="sd">            The total aerosol mass concentration $M_0$ (µg.m⁻³) can be expressed as:</span>

<span class="sd">            $$</span>
<span class="sd">            M_0 = \int_{r_{min}}^{r_{max}} M(r) dr</span>
<span class="sd">            $$</span>

<span class="sd">            where $M(r)$ is the mass size distribution (MSD).</span>

<span class="sd">            This can be rewritten in terms of NSD and MSD as:</span>

<span class="sd">            $$</span>
<span class="sd">            M_0 = \int_{r_{min}}^{r_{max}} \\frac{4\pi r^3}{3} \\rho N(r) dr</span>
<span class="sd">            $$</span>

<span class="sd">            where $\\rho$ is the particle density (kg.m⁻³).</span>

<span class="sd">            By normalizing the NSD with respect to the fine mode ($N(r) = N_0 N_1(r)$), we arrive at:</span>

<span class="sd">            $$</span>
<span class="sd">            M_0 = \sigma_{ext} \\rho \\frac{4}{3} \\frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}</span>
<span class="sd">            $$</span>

<span class="sd">            We define the `conversion factor` (in m) as:</span>

<span class="sd">            $$</span>
<span class="sd">            c_v = \\frac{4}{3} \\frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}</span>
<span class="sd">            $$</span>

<span class="sd">            Thus, the equation simplifies to:</span>

<span class="sd">            $$</span>
<span class="sd">            M_0 = \sigma_{ext} \\rho c_v</span>
<span class="sd">            $$</span>

<span class="sd">            Finally, the `Extinction to Mass Coefficient` (MEC, also called `mass extinction cross section`, usually in m².g⁻¹) is defined as:</span>

<span class="sd">            $$</span>
<span class="sd">            MEC = \\frac{\sigma_{ext}}{M_0} = \\frac{1}{\\rho c_v}</span>
<span class="sd">            $$</span>

<span class="sd">            with $\\rho$ expressed in g.m⁻³.</span>


<span class="sd">            &lt;table&gt;</span>
<span class="sd">                &lt;thead&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;th&gt;Aerosol Type&lt;/th&gt;</span>
<span class="sd">                        &lt;th colspan=2&gt;Conversion Factor (µm)&lt;/th&gt;</span>
<span class="sd">                        &lt;th colspan=2&gt;MEC (m².g⁻¹) &lt;/th&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;th&gt;&lt;/th&gt;</span>
<span class="sd">                        &lt;th&gt;532 nm&lt;/th&gt;</span>
<span class="sd">                        &lt;th&gt;1064 nm&lt;/th&gt;</span>
<span class="sd">                        &lt;th&gt;532 nm&lt;/th&gt;</span>
<span class="sd">                        &lt;th&gt;1064 nm&lt;/th&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                &lt;/thead&gt;</span>
<span class="sd">                &lt;tbody&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;td&gt;Urban&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.31&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;1.92&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;1.86&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.31&lt;/td&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;td&gt;Desert dust&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;1.04&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.58&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.38&lt;/td&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;td&gt;Biomass burning&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.26&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;1.28&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;3.30&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                    &lt;tr&gt;</span>
<span class="sd">                        &lt;td&gt;Volcanic ash&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.62&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.56&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.62&lt;/td&gt;</span>
<span class="sd">                        &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                    &lt;/tr&gt;</span>
<span class="sd">                &lt;/tbody&gt;</span>
<span class="sd">                &lt;caption&gt;Conversion Factors and MEC calculated for the main aerosol types&lt;/caption&gt;</span>
<span class="sd">            &lt;/table&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">def</span><span class="w"> </span><span class="nf">_compute_conv_factor</span><span class="p">(</span><span class="n">nsd</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Compute Conversion Factor for a given Size Distribution and Efficiency</span>

<span class="sd">            Args:</span>
<span class="sd">                nsd (1D Array): Number Size Distribution (µm-3.µm-1)</span>
<span class="sd">                qext (1D Array): Extinction Efficiency (unitless)</span>
<span class="sd">                radius (1D Array): Radius, in µm</span>

<span class="sd">            Returns:</span>
<span class="sd">                (float): Conversion factor (m)</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># radius resolution</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>

            <span class="c1"># integrals</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="p">[</span><span class="n">nsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))]</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">nsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">qext</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="n">int1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nancumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">int2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nancumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">conv_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">int1</span> <span class="o">/</span> <span class="n">int2</span><span class="p">)</span>

            <span class="c1"># conversion form µm to m</span>
            <span class="n">conv_factor</span> <span class="o">=</span> <span class="n">conv_factor</span> <span class="o">*</span> <span class="mf">1e-6</span>
            <span class="k">return</span> <span class="n">conv_factor</span>

        <span class="c1"># generate a size distribution for given aer_type</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">size_distribution</span><span class="o">.</span><span class="n">SizeDistributionData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="p">)</span>

        <span class="c1"># calculate efficiency extinction qext</span>
        <span class="c1"># size parameter</span>
        <span class="c1"># as the radius is in µm and the wavelength is in nm, one must convert the wavelength to µm</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span><span class="p">]</span>
        <span class="c1"># refractive index</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;ref_index&quot;</span><span class="p">][</span><span class="s2">&quot;real&quot;</span><span class="p">],</span>
            <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;ref_index&quot;</span><span class="p">][</span><span class="s2">&quot;imag&quot;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="c1"># mie calculation</span>
        <span class="n">qext</span><span class="p">,</span> <span class="n">_qsca</span><span class="p">,</span> <span class="n">_qback</span><span class="p">,</span> <span class="n">_g</span> <span class="o">=</span> <span class="n">miepython</span><span class="o">.</span><span class="n">mie</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="c1"># output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nsd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">nsd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">vsd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qext</span> <span class="o">=</span> <span class="n">qext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span> <span class="o">=</span> <span class="n">_compute_conv_factor</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nsd</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mec</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span>
        <span class="p">)</span>  <span class="c1"># convert density from g.cm-3 to g.m-3</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot main information of an instance of the [`MECData`](#aprofiles.mec.MECData) class.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            #import aprofiles</span>
<span class="sd">            import aprofiles as apro</span>
<span class="sd">            #compute mec for biomas burning particles at 532 nm</span>
<span class="sd">            mec = apro.mec.MECData(&#39;volcanic_ash&#39;, 532.);</span>
<span class="sd">            #plot information</span>
<span class="sd">            mec.plot()</span>
<span class="sd">            ```</span>

<span class="sd">            ![Volcanic Ash particles properties used for MEC calculation](../../assets/images/volcanic_ash-mec.png)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

        <span class="c1"># plot Volume Size Distribution in 1st axis</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;VSD&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V(r) (µm2.µm-3)&quot;</span><span class="p">)</span>

        <span class="c1"># plot Number Size Distribution in 2nd axis</span>
        <span class="k">if</span> <span class="s2">&quot;nsd&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="c1"># add secondary yaxis</span>
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qext</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Qext&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Qext (unitless)&quot;</span><span class="p">)</span>
            <span class="c1"># ax2.set_ylim([0,10])</span>

        <span class="c1"># add additional information</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.975</span><span class="p">,</span>
            <span class="mf">0.85</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$at\ \lambda=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">\ nm$&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.975</span><span class="p">,</span>
            <span class="mf">0.80</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$c_v: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">\ \mu m$&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.975</span><span class="p">,</span>
            <span class="mf">0.75</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$MEC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mec</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">\ m^2/g$&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (µm)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> particles properties for MEC calculation&quot;</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aprofiles.mec.MECData.get_mec" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mec</span><span class="p">()</span></code>

<a href="#aprofiles.mec.MECData.get_mec" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Extinction to Mass Coefficient for a given type of particles, assuming a prescribed size distribution shape (with unknown amplitude), density, and using <a href="https://miepython.readthedocs.io">Mie theory</a> to calculate the extinction efficiency.</p>
<p>Returns:
     (MECData): with additional attributes:</p>
<div class="codehilite"><pre><span></span><code>     - `nsd` (1D Array): Number Size Distribution
     - `vsd` (1D Array): Volume Size Distribution
     - `radius` (1D Array): Radius in µm
     - `x` (1D Array): Size parameter (unitless)
     - `conv_factor` (float): Conversion factor in m
     - `mec` (float): Extinction to Mass Coefficient in m².g⁻¹
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a population of particles, the extinction coefficient <span class="arithmatex">\(\sigma_{ext}\)</span> (m⁻¹) can be written as follows:</p>
<p>$$
 \sigma_{ext} = \int_{r_{min}}^{r_{max}} N(r) Q_{ext}(m, r, \lambda) \pi r^2 dr
 $$</p>
<p>where <span class="arithmatex">\(Q_{ext}\)</span> is the <code>extinction efficiency</code> and <span class="arithmatex">\(N(r)\)</span> is the <code>Number Size Distribution</code> (NSD).</p>
<p><span class="arithmatex">\(Q_{ext}\)</span> varies with the refractive index, <span class="arithmatex">\(m\)</span>, the wavelength, <span class="arithmatex">\(\lambda\)</span>, and can be calculated for spherical particles using Mie theory.</p>
<p>The total aerosol mass concentration <span class="arithmatex">\(M_0\)</span> (µg.m⁻³) can be expressed as:</p>
<p>$$
 M_0 = \int_{r_{min}}^{r_{max}} M(r) dr
 $$</p>
<p>where <span class="arithmatex">\(M(r)\)</span> is the mass size distribution (MSD).</p>
<p>This can be rewritten in terms of NSD and MSD as:</p>
<p>$$
 M_0 = \int_{r_{min}}^{r_{max}} \frac{4\pi r^3}{3} \rho N(r) dr
 $$</p>
<p>where <span class="arithmatex">\(\rho\)</span> is the particle density (kg.m⁻³).</p>
<p>By normalizing the NSD with respect to the fine mode (<span class="arithmatex">\(N(r) = N_0 N_1(r)\)</span>), we arrive at:</p>
<p>$$
 M_0 = \sigma_{ext} \rho \frac{4}{3} \frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}
 $$</p>
<p>We define the <code>conversion factor</code> (in m) as:</p>
<p>$$
 c_v = \frac{4}{3} \frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}
 $$</p>
<p>Thus, the equation simplifies to:</p>
<p>$$
 M_0 = \sigma_{ext} \rho c_v
 $$</p>
<p>Finally, the <code>Extinction to Mass Coefficient</code> (MEC, also called <code>mass extinction cross section</code>, usually in m².g⁻¹) is defined as:</p>
<p>$$
 MEC = \frac{\sigma_{ext}}{M_0} = \frac{1}{\rho c_v}
 $$</p>
<p>with <span class="arithmatex">\(\rho\)</span> expressed in g.m⁻³.</p>
<p><table>
     <thead>
         <tr>
             <th>Aerosol Type</th>
             <th colspan=2>Conversion Factor (µm)</th>
             <th colspan=2>MEC (m².g⁻¹) </th>
         </tr>
         <tr>
             <th></th>
             <th>532 nm</th>
             <th>1064 nm</th>
             <th>532 nm</th>
             <th>1064 nm</th>
         </tr>
     </thead>
     <tbody>
         <tr>
             <td>Urban</td>
             <td>0.31</td>
             <td>1.92</td>
             <td>1.86</td>
             <td>0.31</td>
         </tr>
         <tr>
             <td>Desert dust</td>
             <td>0.68</td>
             <td>1.04</td>
             <td>0.58</td>
             <td>0.38</td>
         </tr>
         <tr>
             <td>Biomass burning</td>
             <td>0.26</td>
             <td>1.28</td>
             <td>3.30</td>
             <td>0.68</td>
         </tr>
         <tr>
             <td>Volcanic ash</td>
             <td>0.62</td>
             <td>0.56</td>
             <td>0.62</td>
             <td>0.68</td>
         </tr>
     </tbody>
     <caption>Conversion Factors and MEC calculated for the main aerosol types</caption>
 </table></p>
</div>


            <details class="quote">
              <summary>Source code in <code>aprofiles/mec.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_mec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the Extinction to Mass Coefficient for a given type of particles, assuming a prescribed size distribution shape (with unknown amplitude), density, and using [Mie theory](https://miepython.readthedocs.io) to calculate the extinction efficiency.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (MECData): with additional attributes:</span>

<span class="sd">            - `nsd` (1D Array): Number Size Distribution</span>
<span class="sd">            - `vsd` (1D Array): Volume Size Distribution</span>
<span class="sd">            - `radius` (1D Array): Radius in µm</span>
<span class="sd">            - `x` (1D Array): Size parameter (unitless)</span>
<span class="sd">            - `conv_factor` (float): Conversion factor in m</span>
<span class="sd">            - `mec` (float): Extinction to Mass Coefficient in m².g⁻¹</span>

<span class="sd">   !!! note</span>
<span class="sd">        For a population of particles, the extinction coefficient $\sigma_{ext}$ (m⁻¹) can be written as follows:</span>

<span class="sd">        $$</span>
<span class="sd">        \sigma_{ext} = \int_{r_{min}}^{r_{max}} N(r) Q_{ext}(m, r, \lambda) \pi r^2 dr</span>
<span class="sd">        $$</span>

<span class="sd">        where $Q_{ext}$ is the `extinction efficiency` and $N(r)$ is the `Number Size Distribution` (NSD).</span>

<span class="sd">        $Q_{ext}$ varies with the refractive index, $m$, the wavelength, $\lambda$, and can be calculated for spherical particles using Mie theory.</span>

<span class="sd">        The total aerosol mass concentration $M_0$ (µg.m⁻³) can be expressed as:</span>

<span class="sd">        $$</span>
<span class="sd">        M_0 = \int_{r_{min}}^{r_{max}} M(r) dr</span>
<span class="sd">        $$</span>

<span class="sd">        where $M(r)$ is the mass size distribution (MSD).</span>

<span class="sd">        This can be rewritten in terms of NSD and MSD as:</span>

<span class="sd">        $$</span>
<span class="sd">        M_0 = \int_{r_{min}}^{r_{max}} \\frac{4\pi r^3}{3} \\rho N(r) dr</span>
<span class="sd">        $$</span>

<span class="sd">        where $\\rho$ is the particle density (kg.m⁻³).</span>

<span class="sd">        By normalizing the NSD with respect to the fine mode ($N(r) = N_0 N_1(r)$), we arrive at:</span>

<span class="sd">        $$</span>
<span class="sd">        M_0 = \sigma_{ext} \\rho \\frac{4}{3} \\frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}</span>
<span class="sd">        $$</span>

<span class="sd">        We define the `conversion factor` (in m) as:</span>

<span class="sd">        $$</span>
<span class="sd">        c_v = \\frac{4}{3} \\frac{\int_{r_{min}}^{r_{max}} N_1(r) r^3 dr}{\int_{r_{min}}^{r_{max}} N_1(r) Q_{ext}(m, r, \lambda) r^2 dr}</span>
<span class="sd">        $$</span>

<span class="sd">        Thus, the equation simplifies to:</span>

<span class="sd">        $$</span>
<span class="sd">        M_0 = \sigma_{ext} \\rho c_v</span>
<span class="sd">        $$</span>

<span class="sd">        Finally, the `Extinction to Mass Coefficient` (MEC, also called `mass extinction cross section`, usually in m².g⁻¹) is defined as:</span>

<span class="sd">        $$</span>
<span class="sd">        MEC = \\frac{\sigma_{ext}}{M_0} = \\frac{1}{\\rho c_v}</span>
<span class="sd">        $$</span>

<span class="sd">        with $\\rho$ expressed in g.m⁻³.</span>


<span class="sd">        &lt;table&gt;</span>
<span class="sd">            &lt;thead&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;th&gt;Aerosol Type&lt;/th&gt;</span>
<span class="sd">                    &lt;th colspan=2&gt;Conversion Factor (µm)&lt;/th&gt;</span>
<span class="sd">                    &lt;th colspan=2&gt;MEC (m².g⁻¹) &lt;/th&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;th&gt;&lt;/th&gt;</span>
<span class="sd">                    &lt;th&gt;532 nm&lt;/th&gt;</span>
<span class="sd">                    &lt;th&gt;1064 nm&lt;/th&gt;</span>
<span class="sd">                    &lt;th&gt;532 nm&lt;/th&gt;</span>
<span class="sd">                    &lt;th&gt;1064 nm&lt;/th&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">            &lt;/thead&gt;</span>
<span class="sd">            &lt;tbody&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;td&gt;Urban&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.31&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;1.92&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;1.86&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.31&lt;/td&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;td&gt;Desert dust&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;1.04&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.58&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.38&lt;/td&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;td&gt;Biomass burning&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.26&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;1.28&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;3.30&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">                &lt;tr&gt;</span>
<span class="sd">                    &lt;td&gt;Volcanic ash&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.62&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.56&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.62&lt;/td&gt;</span>
<span class="sd">                    &lt;td&gt;0.68&lt;/td&gt;</span>
<span class="sd">                &lt;/tr&gt;</span>
<span class="sd">            &lt;/tbody&gt;</span>
<span class="sd">            &lt;caption&gt;Conversion Factors and MEC calculated for the main aerosol types&lt;/caption&gt;</span>
<span class="sd">        &lt;/table&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_conv_factor</span><span class="p">(</span><span class="n">nsd</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute Conversion Factor for a given Size Distribution and Efficiency</span>

<span class="sd">        Args:</span>
<span class="sd">            nsd (1D Array): Number Size Distribution (µm-3.µm-1)</span>
<span class="sd">            qext (1D Array): Extinction Efficiency (unitless)</span>
<span class="sd">            radius (1D Array): Radius, in µm</span>

<span class="sd">        Returns:</span>
<span class="sd">            (float): Conversion factor (m)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># radius resolution</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>

        <span class="c1"># integrals</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="p">[</span><span class="n">nsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))]</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nsd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">qext</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="n">int1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nancumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">int2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nancumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">conv_factor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">int1</span> <span class="o">/</span> <span class="n">int2</span><span class="p">)</span>

        <span class="c1"># conversion form µm to m</span>
        <span class="n">conv_factor</span> <span class="o">=</span> <span class="n">conv_factor</span> <span class="o">*</span> <span class="mf">1e-6</span>
        <span class="k">return</span> <span class="n">conv_factor</span>

    <span class="c1"># generate a size distribution for given aer_type</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="n">size_distribution</span><span class="o">.</span><span class="n">SizeDistributionData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="p">)</span>

    <span class="c1"># calculate efficiency extinction qext</span>
    <span class="c1"># size parameter</span>
    <span class="c1"># as the radius is in µm and the wavelength is in nm, one must convert the wavelength to µm</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span><span class="p">]</span>
    <span class="c1"># refractive index</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;ref_index&quot;</span><span class="p">][</span><span class="s2">&quot;real&quot;</span><span class="p">],</span>
        <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;ref_index&quot;</span><span class="p">][</span><span class="s2">&quot;imag&quot;</span><span class="p">]),</span>
    <span class="p">)</span>
    <span class="c1"># mie calculation</span>
    <span class="n">qext</span><span class="p">,</span> <span class="n">_qsca</span><span class="p">,</span> <span class="n">_qback</span><span class="p">,</span> <span class="n">_g</span> <span class="o">=</span> <span class="n">miepython</span><span class="o">.</span><span class="n">mie</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="c1"># output</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nsd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">nsd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">vsd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qext</span> <span class="o">=</span> <span class="n">qext</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span> <span class="o">=</span> <span class="n">_compute_conv_factor</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">nsd</span><span class="p">,</span> <span class="n">qext</span><span class="p">,</span> <span class="n">sd</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mec</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer_properties</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e6</span>
    <span class="p">)</span>  <span class="c1"># convert density from g.cm-3 to g.m-3</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aprofiles.mec.MECData.plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#aprofiles.mec.MECData.plot" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot main information of an instance of the <a href="#aprofiles.mec.MECData.plot--aprofiles.mec.MECData"><code>MECData</code></a> class.</p>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="c1">#import aprofiles</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">aprofiles</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">apro</span>
<span class="c1">#compute mec for biomas burning particles at 532 nm</span>
<span class="n">mec</span> <span class="o">=</span> <span class="n">apro</span><span class="o">.</span><span class="n">mec</span><span class="o">.</span><span class="n">MECData</span><span class="p">(</span><span class="s1">&#39;volcanic_ash&#39;</span><span class="p">,</span> <span class="mf">532.</span><span class="p">);</span>
<span class="c1">#plot information</span>
<span class="n">mec</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
<p><img alt="Volcanic Ash particles properties used for MEC calculation" src="../../assets/images/volcanic_ash-mec.png" /></p>
</details>

            <details class="quote">
              <summary>Source code in <code>aprofiles/mec.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_fig</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot main information of an instance of the [`MECData`](#aprofiles.mec.MECData) class.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        #import aprofiles</span>
<span class="sd">        import aprofiles as apro</span>
<span class="sd">        #compute mec for biomas burning particles at 532 nm</span>
<span class="sd">        mec = apro.mec.MECData(&#39;volcanic_ash&#39;, 532.);</span>
<span class="sd">        #plot information</span>
<span class="sd">        mec.plot()</span>
<span class="sd">        ```</span>

<span class="sd">        ![Volcanic Ash particles properties used for MEC calculation](../../assets/images/volcanic_ash-mec.png)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># plot Volume Size Distribution in 1st axis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsd</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;VSD&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;V(r) (µm2.µm-3)&quot;</span><span class="p">)</span>

    <span class="c1"># plot Number Size Distribution in 2nd axis</span>
    <span class="k">if</span> <span class="s2">&quot;nsd&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
        <span class="c1"># add secondary yaxis</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qext</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Qext&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Qext (unitless)&quot;</span><span class="p">)</span>
        <span class="c1"># ax2.set_ylim([0,10])</span>

    <span class="c1"># add additional information</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.975</span><span class="p">,</span>
        <span class="mf">0.85</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$at\ \lambda=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">\ nm$&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.975</span><span class="p">,</span>
        <span class="mf">0.80</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$c_v: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">conv_factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">\ \mu m$&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.975</span><span class="p">,</span>
        <span class="mf">0.75</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$MEC: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mec</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">\ m^2/g$&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (µm)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">aer_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> particles properties for MEC calculation&quot;</span><span class="p">,</span>
        <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">show_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Dubovik, O., Holben, B., Eck, T. F., Smirnov, A., Kaufman, Y. J., King, M. D., ... &amp; Slutsker, I. (2002). Variability of absorption and optical properties of key aerosol types observed in worldwide locations. <em>Journal of the Atmospheric Sciences</em>, 59(3), 590-608.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Mortier, A., Goloub, P., Podvin, T., Deroo, C., Chaikovsky, A., Ajtai, N., ... &amp; Derimian, Y. (2013). Detection and characterization of volcanic ash plumes over Lille during the Eyjafjallajökull eruption. <em>Atmospheric Chemistry and Physics</em>, 13(7), 3705-3720.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../reading/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Reading">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Reading
              </div>
            </div>
          </a>
        
        
          
          <a href="../detection/" class="md-footer__link md-footer__link--next" aria-label="Next: Detection">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Detection
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2024, Augustin Mortier
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://vprofiles.met.no" target="_blank" rel="noopener" title="V-Profiles" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m503.5 204.6-.7-1.8-69.7-181.78c-1.4-3.57-3.9-6.59-7.2-8.64-2.4-1.55-5.1-2.515-8-2.81s-5.7.083-8.4 1.11c-2.7 1.02-5.1 2.66-7.1 4.78-1.9 2.12-3.3 4.67-4.1 7.44l-47 144H160.8l-47.1-144c-.8-2.77-2.2-5.31-4.1-7.43-2-2.12-4.4-3.75-7.1-4.77a18.1 18.1 0 0 0-8.38-1.113 18.4 18.4 0 0 0-8.04 2.793 18.1 18.1 0 0 0-7.16 8.64L9.267 202.8l-.724 1.8a129.57 129.57 0 0 0-3.52 82c7.747 26.9 24.047 50.7 46.447 67.6l.27.2.59.4 105.97 79.5 52.6 39.7 32 24.2c3.7 1.9 8.3 4.3 13 4.3s9.3-2.4 13-4.3l32-24.2 52.6-39.7 106.7-79.9.3-.3c22.4-16.9 38.7-40.6 45.6-67.5 8.6-27 7.4-55.8-2.6-82"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.sections", "navigation.footer", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../assets/js/custom.js"></script>
      
        <script src="../../assets/js/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>